<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>KET Speaking 1-to-1 ¬∑ T1 About Me & School</title>

  <style>
    :root{
      --bgA:#F6FBFF; --bgB:#FFF6FB;
      --ink:#1E2A44; --mut:#5A6A86;

      --card:#FFFFFF;
      --stroke: rgba(30,42,68,.12);
      --shadow: 0 18px 40px rgba(30,42,68,.10);

      --blue:#4D96FF; --pink:#FB7185; --green:#22C55E; --purple:#8B5CF6; --amber:#FBBF24;

      --r: 24px;
      --pad: 52px;
      --padM: 16px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; overflow:hidden;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      color:var(--ink);
      background:
        radial-gradient(900px 560px at 14% 12%, rgba(77,150,255,.18), transparent 58%),
        radial-gradient(920px 580px at 86% 18%, rgba(251,113,133,.16), transparent 58%),
        radial-gradient(780px 540px at 60% 90%, rgba(34,197,94,.11), transparent 60%),
        linear-gradient(120deg, var(--bgA), var(--bgB));
    }

    /* Deck */
    #deck{height:100vh;width:100vw;position:relative}
    .slide{position:absolute; inset:0; padding: var(--pad) var(--pad) 92px; display:none;}
    .slide.active{display:block}
    @media (max-width: 980px){ .slide{padding:46px var(--padM) 92px} }

    /* Header */
    .header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:14px;}
    .badge{
      display:inline-flex;align-items:center;gap:10px;
      padding:10px 14px;border-radius:999px;
      background: rgba(255,255,255,.82);
      border:1px solid var(--stroke);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      user-select:none;
      color:var(--mut);
      font-size:14px;
    }
    .badge .dot{width:10px;height:10px;border-radius:50%;background: linear-gradient(135deg, var(--blue), var(--purple));box-shadow: 0 0 0 4px rgba(77,150,255,.16);}
    .meta{display:flex;align-items:center;gap:10px;flex-wrap:wrap;user-select:none;color:var(--mut);font-size:14px;}
    .pill{padding:9px 12px;border-radius:999px;background: rgba(255,255,255,.82);border:1px solid var(--stroke);box-shadow: var(--shadow);backdrop-filter: blur(10px);}
    button{
      appearance:none;border:none;cursor:pointer;
      padding:12px 14px;border-radius:14px;
      background: rgba(255,255,255,.90);
      border:1px solid var(--stroke);
      color:var(--ink);
      font-size:14px;
      box-shadow: 0 10px 22px rgba(30,42,68,.08);
    }
    button.primary{background: rgba(34,197,94,.14);border-color: rgba(34,197,94,.22)}
    button.blue{background: rgba(77,150,255,.14);border-color: rgba(77,150,255,.22)}
    button.pink{background: rgba(251,113,133,.14);border-color: rgba(251,113,133,.22)}
    button:active{transform: translateY(1px)}

    /* Layout */
    .wrap{
      height: calc(100vh - 92px - 46px);
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap:16px;
    }
    .wrap.one{grid-template-columns:1fr}
    @media (max-width: 980px){ .wrap{grid-template-columns:1fr} }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.98), rgba(255,255,255,.92));
      border:1px solid var(--stroke);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      padding:16px 16px 14px;
      overflow:auto;
    }
    .card.soft{background: linear-gradient(180deg, rgba(244,248,255,.92), rgba(255,255,255,.92));}

    h1{margin:0 0 10px;font-size:38px;letter-spacing:.2px}
    h2{margin:0 0 10px;font-size:26px}
    .sub{color:var(--mut);font-size:16px;line-height:1.55}
    .big{font-size:18px;line-height:1.65}
    .mini{font-size:14px;color:var(--mut);line-height:1.55}

    /* Your Turn */
    .turn{
      margin-top:12px;border-radius:18px;
      border:2px dashed rgba(77,150,255,.24);
      background: rgba(255,255,255,.88);
      padding:12px;
    }
    .turn .tTitle{display:flex;align-items:center;gap:10px;font-size:16px;color:var(--ink);margin-bottom:6px;user-select:none;}
    .turn ul{margin:8px 0 0;padding-left:18px;color:var(--mut);line-height:1.6}

    /* Scene */
    .scene{
      width:100%;
      border-radius:20px;
      border:1px solid var(--stroke);
      box-shadow: var(--shadow);
      background: linear-gradient(120deg, rgba(77,150,255,.10), rgba(251,113,133,.08), rgba(34,197,94,.08));
      overflow:hidden;
      display:grid;
      place-items:center;
      padding:10px;
      margin-top:10px;
      min-height: 210px;
    }

    /* Tiles */
    .grid{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:12px;
      margin-top:10px;
    }
    @media (max-width: 980px){ .grid{grid-template-columns: repeat(2, 1fr)} }

    .tile{
      border-radius:18px;border:1px solid var(--stroke);
      background: rgba(255,255,255,.88);
      box-shadow: 0 12px 26px rgba(30,42,68,.08);
      padding:12px; cursor:pointer; user-select:none;
      transition: transform .08s ease, outline .08s ease;
      min-height: 108px;
      position:relative; overflow:hidden;
    }
    .tile:active{transform: translateY(1px)}
    .tag{
      position:absolute; top:10px; right:10px;
      padding:6px 10px;border-radius:999px;
      font-size:12px;
      border:1px solid rgba(30,42,68,.12);
      background: rgba(255,255,255,.85);
      color:var(--mut);
    }
    .w{display:flex;align-items:flex-start;gap:10px;}
    .icon{width:28px;height:28px;flex:0 0 auto}
    .word{font-size:18px;color:var(--ink)}
    .hint{margin-top:8px;color:var(--mut);font-size:14px;line-height:1.5}
    .tile .back{display:none;margin-top:8px}
    .tile.on .front{display:none}
    .tile.on .back{display:block}
    .tile.on{outline: 3px solid rgba(77,150,255,.20)}

    /* Chat bubbles (dialogue practice) */
    .chat{display:grid;gap:10px;margin-top:10px}
    .bubble{
      max-width: 92%;
      padding:12px 14px;
      border-radius: 18px;
      border:1px solid rgba(30,42,68,.10);
      background: rgba(255,255,255,.86);
      font-size:18px; line-height:1.55;
      box-shadow: 0 10px 22px rgba(30,42,68,.08);
    }
    .bubble.t{justify-self:start;border-top-left-radius:10px}
    .bubble.s{justify-self:end;background: rgba(77,150,255,.12);border-color: rgba(77,150,255,.22);border-top-right-radius:10px}
    .bubble small{display:block;color:var(--mut);font-size:13px;margin-top:6px}

    /* Bottom nav */
    #nav{
      position:absolute;left:18px;right:18px;bottom:14px;height:54px;
      border-radius:18px;
      background: rgba(255,255,255,.86);
      border:1px solid var(--stroke);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      display:flex;align-items:center;justify-content:space-between;
      padding:8px 10px; gap:10px;
      user-select:none;
    }
    .navBtn{
      padding:10px 12px;border-radius:14px;
      background: rgba(77,150,255,.12);
      border:1px solid rgba(77,150,255,.20);
      cursor:pointer;
      font-size:14px;
      white-space:nowrap;
    }
    .navBtn.secondary{background: rgba(251,113,133,.12);border-color: rgba(251,113,133,.20);}
    .navBtn:disabled{opacity:.45;cursor:not-allowed}
    .center{
      display:flex;align-items:center;gap:10px;
      min-width: 280px;
      justify-content:center;
      color:var(--mut);
      font-size:14px;
      text-align:center;
      flex:1;
    }
    .progress{height:8px;width:220px;background: rgba(30,42,68,.10);border-radius:999px;overflow:hidden;border:1px solid rgba(30,42,68,.08);}
    .bar{height:100%;width:0%;background: linear-gradient(135deg, var(--blue), var(--purple));border-radius:999px;transition: width .2s ease;}

    /* Picker overlay */
    #picker{
      position:fixed; inset:0;
      background: rgba(30,42,68,.26);
      backdrop-filter: blur(10px);
      display:none;
      z-index:999;
      padding:18px;
    }
    #picker.on{display:block}
    .pickerPanel{
      max-width: 980px;
      margin: 0 auto;
      background: rgba(255,255,255,.92);
      border:1px solid var(--stroke);
      border-radius: 22px;
      box-shadow: var(--shadow);
      padding:16px;
      max-height: calc(100vh - 36px);
      overflow:auto;
    }
    .pickerTop{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:10px;}
    .pickerTop h3{margin:0;font-size:18px;color:var(--ink)}
    .list{display:grid;grid-template-columns: repeat(3, 1fr);gap:10px;}
    @media (max-width: 980px){ .list{grid-template-columns: repeat(2, 1fr)} }
    .jump{
      padding:12px;border-radius:18px;border:1px solid var(--stroke);
      background: rgba(255,255,255,.88);
      cursor:pointer; user-select:none;
    }
    .jump small{display:block;color:var(--mut);margin-top:4px}

    /* Timer */
    .timerWrap{display:flex;align-items:center;gap:16px;flex-wrap:wrap;margin-top:10px}
    .ring{
      width:240px;height:240px;border-radius:50%;
      background: conic-gradient(var(--blue) var(--deg), rgba(30,42,68,.10) 0);
      border:1px solid var(--stroke);
      box-shadow: var(--shadow);
      display:grid;place-items:center;
      position:relative;
      --deg: 0deg;
    }
    .ring::after{
      content:""; position:absolute; inset:16px; border-radius:50%;
      background: rgba(255,255,255,.92);
      border:1px solid var(--stroke);
    }
    .timeBox{position:relative;z-index:2;text-align:center}
    .timeBox .num{font-size:64px;margin:0}
    .timeBox .lab{font-size:14px;color:var(--mut);margin:0}

    /* Sentence counter (fun) */
    .dots{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .dotC{
      width:34px;height:34px;border-radius:999px;
      border:1px solid rgba(30,42,68,.12);
      background: rgba(255,255,255,.88);
      display:grid;place-items:center;
      cursor:pointer; user-select:none;
      box-shadow: 0 10px 18px rgba(30,42,68,.06);
      color:var(--mut); font-weight:600;
    }
    .dotC.on{background: rgba(34,197,94,.16); border-color: rgba(34,197,94,.26); color: var(--ink);}
  </style>
</head>

<body>
<div id="deck"></div>

<!-- Slide picker -->
<div id="picker" aria-hidden="true">
  <div class="pickerPanel">
    <div class="pickerTop">
      <h3>Menu</h3>
      <button onclick="togglePicker(false)">Close</button>
    </div>
    <div class="list" id="pickerList"></div>
  </div>
</div>

<script>
/* ============ SVG ICONS & PICTURES (kid-friendly, no external images) ============ */
function svgIcon(type){
  const s = 'stroke="rgba(30,42,68,.35)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" fill="none"';
  if(type==="tag") return `<svg class="icon" viewBox="0 0 24 24"><path ${s} d="M4 7.5C4 6.1 5.1 5 6.5 5h11C19 5 20 6.1 20 7.5v9C20 17.9 18.9 19 17.5 19h-11C5.1 19 4 17.9 4 16.5v-9Z"/><path d="M7 9h10" stroke="#4D96FF" stroke-width="2.2"/><path d="M7 12h7" stroke="#FB7185" stroke-width="2.2"/></svg>`;
  if(type==="clock") return `<svg class="icon" viewBox="0 0 24 24"><path ${s} d="M12 22a10 10 0 1 0-10-10 10 10 0 0 0 10 10Z"/><path d="M12 6v6l4 2" stroke="#4D96FF" stroke-width="2.2"/></svg>`;
  if(type==="pin") return `<svg class="icon" viewBox="0 0 24 24"><path ${s} d="M12 21s7-4.4 7-10.2A7 7 0 0 0 5 10.8C5 16.6 12 21 12 21Z"/><circle cx="12" cy="11" r="2.6" fill="#22C55E" opacity=".35"/></svg>`;
  if(type==="home") return `<svg class="icon" viewBox="0 0 24 24"><path ${s} d="M3 11l9-7 9 7"/><path ${s} d="M5 10v10h14V10"/><path d="M10 20v-6h4v6" stroke="#FB7185" stroke-width="2.2"/></svg>`;
  if(type==="school") return `<svg class="icon" viewBox="0 0 24 24"><path ${s} d="M4 10.5 12 6l8 4.5v8.2a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-8.2Z"/><path d="M9 20v-6h6v6" stroke="#4D96FF" stroke-width="2.2"/></svg>`;
  if(type==="book") return `<svg class="icon" viewBox="0 0 24 24"><path ${s} d="M6 4h10a2 2 0 0 1 2 2v14H8a2 2 0 0 0-2 2V4Z"/><path d="M8 7h8" stroke="#22C55E" stroke-width="2.2"/></svg>`;
  if(type==="teacher") return `<svg class="icon" viewBox="0 0 24 24"><path ${s} d="M12 12a4 4 0 1 0-4-4 4 4 0 0 0 4 4Z"/><path ${s} d="M4 20a8 8 0 0 1 16 0"/></svg>`;
  if(type==="group") return `<svg class="icon" viewBox="0 0 24 24"><path ${s} d="M16 11a3 3 0 1 0-3-3 3 3 0 0 0 3 3Z"/><path ${s} d="M8 12a3 3 0 1 0-3-3 3 3 0 0 0 3 3Z"/><path ${s} d="M2 20a6 6 0 0 1 10 0"/><path ${s} d="M12 20a6 6 0 0 1 10 0"/></svg>`;
  if(type==="bolt") return `<svg class="icon" viewBox="0 0 24 24"><path ${s} d="M13 2 4 14h7l-1 8 10-12h-7Z"/><path d="M11 14h7" stroke="#FBBF24" stroke-width="2.2"/></svg>`;
  return `<svg class="icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="9" fill="rgba(77,150,255,.18)"/></svg>`;
}

function sceneSVG(kind){
  if(kind==="cover") return `
  <svg viewBox="0 0 900 260" width="100%" height="240" role="img" aria-label="school scene">
    <defs>
      <linearGradient id="g1" x1="0" x2="1">
        <stop offset="0" stop-color="#4D96FF" stop-opacity=".20"/>
        <stop offset="1" stop-color="#FB7185" stop-opacity=".16"/>
      </linearGradient>
    </defs>
    <rect x="0" y="0" width="900" height="260" rx="26" fill="url(#g1)"/>
    <g fill="#fff" opacity=".86">
      <circle cx="160" cy="70" r="22"/><circle cx="190" cy="62" r="28"/><circle cx="228" cy="72" r="22"/>
      <circle cx="690" cy="80" r="18"/><circle cx="718" cy="72" r="24"/><circle cx="750" cy="82" r="18"/>
    </g>
    <g transform="translate(330,55)">
      <polygon points="120,0 260,70 -20,70" fill="rgba(251,191,36,.42)" stroke="rgba(30,42,68,.12)"/>
      <rect x="0" y="70" width="240" height="150" rx="18" fill="#ffffff" opacity=".92" stroke="rgba(30,42,68,.12)"/>
      <rect x="90" y="120" width="60" height="100" rx="10" fill="rgba(77,150,255,.14)" stroke="rgba(77,150,255,.22)"/>
      <rect x="24" y="100" width="45" height="40" rx="8" fill="rgba(34,197,94,.14)" stroke="rgba(34,197,94,.22)"/>
      <rect x="171" y="100" width="45" height="40" rx="8" fill="rgba(34,197,94,.14)" stroke="rgba(34,197,94,.22)"/>
    </g>
    <g transform="translate(200,170)">
      <circle cx="0" cy="0" r="22" fill="#fff" stroke="rgba(30,42,68,.12)"/>
      <rect x="-18" y="25" width="36" height="50" rx="12" fill="rgba(34,197,94,.70)" stroke="rgba(30,42,68,.10)"/>
      <circle cx="-7" cy="-6" r="3" fill="#1E2A44"/><circle cx="7" cy="-6" r="3" fill="#1E2A44"/>
      <path d="M-8 6 Q0 14 8 6" fill="none" stroke="#1E2A44" stroke-width="3" stroke-linecap="round"/>
    </g>
    <g transform="translate(720,175)">
      <circle cx="0" cy="0" r="22" fill="#fff" stroke="rgba(30,42,68,.12)"/>
      <rect x="-18" y="25" width="36" height="50" rx="12" fill="rgba(139,92,246,.65)" stroke="rgba(30,42,68,.10)"/>
      <circle cx="-7" cy="-6" r="3" fill="#1E2A44"/><circle cx="7" cy="-6" r="3" fill="#1E2A44"/>
      <path d="M-8 6 Q0 14 8 6" fill="none" stroke="#1E2A44" stroke-width="3" stroke-linecap="round"/>
    </g>
  </svg>`;
  if(kind==="me") return `
  <svg viewBox="0 0 900 260" width="100%" height="240" role="img" aria-label="me card">
    <rect width="900" height="260" rx="26" fill="rgba(255,255,255,.72)"/>
    <g transform="translate(120,70)">
      <rect x="0" y="0" width="300" height="140" rx="22" fill="rgba(77,150,255,.14)" stroke="rgba(77,150,255,.22)"/>
      <text x="150" y="62" text-anchor="middle" font-size="22" fill="#1E2A44">ME</text>
      <text x="150" y="98" text-anchor="middle" font-size="16" fill="#5A6A86">name ¬∑ age ¬∑ home</text>
    </g>
    <g transform="translate(520,62)">
      <polygon points="0,60 90,0 180,60" fill="rgba(251,113,133,.16)" stroke="rgba(251,113,133,.22)"/>
      <rect x="20" y="60" width="140" height="120" rx="18" fill="#fff" stroke="rgba(30,42,68,.10)"/>
      <rect x="72" y="112" width="56" height="68" rx="12" fill="rgba(77,150,255,.12)" stroke="rgba(77,150,255,.20)"/>
    </g>
  </svg>`;
  if(kind==="school") return `
  <svg viewBox="0 0 900 260" width="100%" height="240" role="img" aria-label="school places">
    <rect width="900" height="260" rx="26" fill="rgba(255,255,255,.72)"/>
    <g transform="translate(110,70)">
      <rect x="0" y="0" width="330" height="150" rx="22" fill="rgba(34,197,94,.14)" stroke="rgba(34,197,94,.22)"/>
      <rect x="28" y="28" width="274" height="64" rx="16" fill="#fff" opacity=".92"/>
      <text x="165" y="70" text-anchor="middle" font-size="18" fill="#1E2A44">classroom</text>
      <rect x="60" y="110" width="84" height="34" rx="12" fill="rgba(77,150,255,.14)" stroke="rgba(77,150,255,.22)"/>
      <rect x="156" y="110" width="84" height="34" rx="12" fill="rgba(77,150,255,.14)" stroke="rgba(77,150,255,.22)"/>
      <rect x="252" y="110" width="50" height="34" rx="12" fill="rgba(77,150,255,.14)" stroke="rgba(77,150,255,.22)"/>
    </g>
    <g transform="translate(520,70)">
      <rect x="0" y="0" width="270" height="150" rx="22" fill="rgba(77,150,255,.14)" stroke="rgba(77,150,255,.22)"/>
      <rect x="26" y="30" width="218" height="86" rx="16" fill="#fff" opacity=".92"/>
      <path d="M56 56h158M56 78h158M56 100h158" stroke="#4D96FF" stroke-width="8" stroke-linecap="round"/>
      <text x="135" y="138" text-anchor="middle" font-size="16" fill="#5A6A86">library</text>
    </g>
  </svg>`;
  return `<svg viewBox="0 0 900 260" width="100%" height="240"><rect width="900" height="260" rx="26" fill="rgba(255,255,255,.72)"/></svg>`;
}

/* ============ DATA (must cover ALL points) ============ */
const personalCore12 = [
  {w:"name", ic:"tag", q:"Teacher asks:", a:"What‚Äôs your name?"},
  {w:"full name", ic:"tag", q:"Teacher asks:", a:"What‚Äôs your full name?"},
  {w:"call me", ic:"tag", q:"Teacher asks:", a:"What can I call you?"},
  {w:"age", ic:"clock", q:"Teacher asks:", a:"How old are you?"},
  {w:"years old", ic:"clock", q:"Say it:", a:"I‚Äôm ___ years old."},
  {w:"live in", ic:"pin", q:"Teacher asks:", a:"Where do you live?"},
  {w:"live with", ic:"home", q:"Teacher asks:", a:"Who do you live with?"},
  {w:"come from", ic:"pin", q:"Teacher asks:", a:"Where are you from?"},
  {w:"city", ic:"pin", q:"Say it:", a:"My city is ___."},
  {w:"family", ic:"group", q:"Teacher asks:", a:"Tell me about your family."},
  {w:"hobby", ic:"bolt", q:"Teacher asks:", a:"What‚Äôs your hobby?"},
  {w:"free time", ic:"bolt", q:"Teacher asks:", a:"What do you do in your free time?"},
];

const schoolCore16 = [
  {w:"student", ic:"school", q:"Teacher asks:", a:"Are you a student?"},
  {w:"school", ic:"school", q:"Teacher asks:", a:"Do you like your school?"},
  {w:"class", ic:"group", q:"Teacher asks:", a:"Which class are you in?"},
  {w:"classroom", ic:"school", q:"Teacher asks:", a:"What‚Äôs your classroom like?"},
  {w:"teacher", ic:"teacher", q:"Teacher asks:", a:"What‚Äôs your teacher like?"},
  {w:"subject", ic:"book", q:"Teacher asks:", a:"What subjects do you study?"},
  {w:"lesson", ic:"book", q:"Say it:", a:"I have ___ lessons on ___."},
  {w:"timetable", ic:"book", q:"Teacher asks:", a:"What‚Äôs on your timetable?"},
  {w:"homework", ic:"book", q:"Teacher asks:", a:"Do you do homework?"},
  {w:"break", ic:"bolt", q:"Teacher asks:", a:"What do you do at break time?"},
  {w:"library", ic:"book", q:"Teacher asks:", a:"Do you go to the library?"},
  {w:"playground", ic:"bolt", q:"Teacher asks:", a:"Do you play in the playground?"},
  {w:"exam", ic:"book", q:"Teacher asks:", a:"Do you have exams?"},
  {w:"club", ic:"bolt", q:"Teacher asks:", a:"Do you go to a club?"},
  {w:"uniform", ic:"school", q:"Teacher asks:", a:"Do you wear a uniform?"},
  {w:"classmates", ic:"group", q:"Teacher asks:", a:"Do you get along with classmates?"},
];

const powerUp10 = ["friendly","helpful","strict","interesting","boring","difficult","easy","useful","popular","comfortable"];

const chunks = [
  {w:"my favourite subject", ic:"book", model:"My favourite subject is ___ because ___."},
  {w:"after-school club", ic:"bolt", model:"After school, I go to an after-school club."},
  {w:"from Monday to Friday", ic:"book", model:"I have lessons from Monday to Friday."},
  {w:"have lessons / have a break", ic:"bolt", model:"We have lessons and then we have a break."},
  {w:"do homework at home", ic:"book", model:"I do homework at home after school."},
  {w:"get along with my classmates", ic:"group", model:"I get along with my classmates because they are friendly."}
];

const keySentences12 = [
  "I‚Äôm a student at ___.",
  "I study at ___ School.",
  "My school is big/clean/friendly.",
  "I study English, maths and ___.",
  "My favourite subject is ___ because ___.",
  "I like it because ___.",
  "I usually have ___ lessons on ___.",
  "My teacher is ___ and ___.",
  "After school, I often ___.",
  "I‚Äôm good at ___ / I‚Äôm not good at ___.",
  "I have lessons / I have a break.",
  "I do homework at home."
];

const highScore6 = [
  "My full name is ___, but you can call me ___.",
  "What I like most is ___.",
  "It helps me ___.",
  "I feel ___ when ___.",
  "I‚Äôm interested in ___.",
  "If I have time, I ___."
];

const examPersonal6 = [
  {q:"What‚Äôs your name?", a:"My name is ___. Nice to meet you."},
  {q:"How old are you?", a:"I‚Äôm ___ years old. I‚Äôm in Grade ___."},
  {q:"Where do you live?", a:"I live in ___. It‚Äôs a nice place."},
  {q:"Who do you live with?", a:"I live with my ___. We are a happy family."},
  {q:"Where are you from?", a:"I come from ___. It‚Äôs in ___."},
  {q:"What do you like doing in your free time?", a:"I like ___. I like it because it‚Äôs ___."},
];

const examSchool6 = [
  {q:"What school do you go to?", a:"I go to ___ School. It‚Äôs a big school in my city."},
  {q:"What subjects do you study?", a:"I study English, maths and ___. English is my favourite."},
  {q:"What‚Äôs your favourite subject? Why?", a:"My favourite subject is ___ because it‚Äôs ___. And because it helps me ___."},
  {q:"Do you like your school? Why?", a:"Yes, I do. My school is ___ and ___. The teachers are ___."},
  {q:"What‚Äôs your teacher like?", a:"My teacher is ___ and ___. The lessons are interesting."},
  {q:"What do you do after school?", a:"After school, I often ___. Then I do homework at home."},
];

/* ============ BUILDING BLOCKS ============ */
function tileCard(item, tagText){
  const t = document.createElement('div');
  t.className = 'tile';
  t.innerHTML = `
    <div class="tag">${tagText}</div>
    <div class="front">
      <div class="w">
        ${svgIcon(item.ic || "tag")}
        <div>
          <div class="word">${item.w}</div>
          <div class="hint">Tap ‚Üí see the prompt</div>
        </div>
      </div>
    </div>
    <div class="back">
      <div class="mini"><b>${item.q || "Teacher asks:"}</b> ${item.a || ""}</div>
      <div class="hint" style="margin-top:6px">Speak 2 sentences.</div>
    </div>
  `;
  t.addEventListener('click', ()=>t.classList.toggle('on'));
  return t;
}

function sentenceTile(text, tagText){
  const t = document.createElement('div');
  t.className = 'tile';
  t.innerHTML = `
    <div class="tag">${tagText}</div>
    <div class="front">
      <div class="w">
        ${svgIcon("book")}
        <div>
          <div class="word">${text}</div>
          <div class="hint">Tap ‚Üí try it</div>
        </div>
      </div>
    </div>
    <div class="back">
      <div class="mini"><b>Say it 2 times:</b></div>
      <div class="hint">${text}</div>
      <div class="hint" style="margin-top:6px">Change the blanks.</div>
    </div>
  `;
  t.addEventListener('click', ()=>t.classList.toggle('on'));
  return t;
}

function qaCard(item, tagText){
  const t = document.createElement('div');
  t.className = 'tile';
  t.innerHTML = `
    <div class="tag">${tagText}</div>
    <div class="front">
      <div class="w">
        ${svgIcon("tag")}
        <div>
          <div class="word">${item.q}</div>
          <div class="hint">Tap ‚Üí sample answer</div>
        </div>
      </div>
    </div>
    <div class="back">
      <div class="mini"><b>Sample answer:</b></div>
      <div class="hint">${item.a}</div>
      <div class="hint" style="margin-top:6px">Now answer with your info.</div>
    </div>
  `;
  t.addEventListener('click', ()=>t.classList.toggle('on'));
  return t;
}

function slideShell({title, stage, rightMeta, one=false}){
  const s = document.createElement('section');
  s.className = 'slide';
  s.dataset.title = title;

  const header = document.createElement('div');
  header.className = 'header';
  header.innerHTML = `
    <div class="badge"><span class="dot"></span> ${stage}</div>
    <div class="meta">
      <span class="pill" data-count>1 / 1</span>
      ${rightMeta ? `<span class="pill">${rightMeta}</span>` : ``}
      <button class="blue" onclick="togglePicker(true)">Menu</button>
    </div>
  `;

  const wrap = document.createElement('div');
  wrap.className = 'wrap' + (one ? ' one' : '');

  s.appendChild(header);
  s.appendChild(wrap);
  return {s, wrap};
}

/* ============ SLIDE DEFINITIONS (step-by-step, teacher-friendly flow) ============ */
const slideDefs = [
  // 1) Title
  {
    title:"Welcome",
    stage:"T1 ¬∑ About Me & School",
    rightMeta:"1-to-1 Speaking",
    one:true,
    left:(root)=>{
      root.innerHTML = `
        <div class="card">
          <h1>About Me & School</h1>
          <div class="sub">KET Speaking ¬∑ 1-to-1</div>
          <div class="scene">${sceneSVG("cover")}</div>
          <div class="turn">
            <div class="tTitle">üé§ Your Turn</div>
            <ul>
              <li>Say: ‚ÄúHello!‚Äù</li>
              <li>Say: ‚ÄúNice to meet you.‚Äù</li>
            </ul>
          </div>
        </div>
      `;
    }
  },

  // 2) Today‚Äôs lesson flow (teacher tells theme + steps)
  {
    title:"Today‚Äôs Steps",
    stage:"Step-by-step",
    rightMeta:"Follow the path",
    left:(root)=>{
      root.innerHTML = `
        <div class="card">
          <h2>Today we will‚Ä¶</h2>
          <div class="scene" style="min-height:240px">
            <div style="max-width:760px;width:100%;display:grid;gap:10px">
              ${[
                "1) Learn words",
                "2) Learn sentences",
                "3) Practice dialogues",
                "4) Learn the speaking map",
                "5) Speak 40‚Äì50 seconds"
              ].map(x=>`<div style="background:rgba(77,150,255,.08);border:1px solid rgba(77,150,255,.16);padding:12px;border-radius:18px;font-size:18px">${x}</div>`).join("")}
            </div>
          </div>
          <div class="turn">
            <div class="tTitle">üé§ Your Turn</div>
            <ul>
              <li>Repeat: ‚ÄúToday I will speak a lot.‚Äù</li>
            </ul>
          </div>
        </div>
      `;
    },
    right:(root)=>{
      root.innerHTML = `
        <div class="card soft">
          <h2>Goal</h2>
          <div class="big"><b>40‚Äì50 seconds</b><br><b>6+ sentences</b><br><b>because √ó2</b></div>
          <div class="dots" id="goalDots"></div>
          <div class="mini" style="margin-top:8px">Tap dots when you say each sentence.</div>
        </div>
      `;
    },
    onMount:()=>{
      const d = document.getElementById('goalDots');
      d.innerHTML = "";
      for(let i=1;i<=6;i++){
        const x=document.createElement('div');
        x.className='dotC';
        x.textContent=i;
        x.onclick=()=>x.classList.toggle('on');
        d.appendChild(x);
      }
    }
  },

  // 3) Warm-up imitation (quick speaking)
  {
    title:"Warm-up",
    stage:"Warm-up",
    rightMeta:"Copy + Change",
    left:(root)=>{
      root.innerHTML = `
        <div class="card">
          <h2>Warm-up: Copy</h2>
          <div class="sub">Teacher says ‚Üí you copy (2 times).</div>
          <div class="scene">
            <div style="max-width:780px;width:100%">
              <div style="font-size:18px;line-height:1.7;background:rgba(77,150,255,.08);border:1px solid rgba(77,150,255,.18);padding:14px;border-radius:18px">
                My name is Alex. I‚Äôm 12 years old.<br>
                I study at Sunshine School because it‚Äôs friendly.
              </div>
            </div>
          </div>
          <div class="turn">
            <div class="tTitle">üé§ Your Turn</div>
            <ul>
              <li>Round 1: copy the teacher</li>
              <li>Round 2: change to YOUR info</li>
            </ul>
          </div>
        </div>
      `;
    },
    right:(root)=>{
      root.innerHTML = `
        <div class="card soft">
          <h2>Warm-up: Change</h2>
          <div class="sub">Make 2 sentences + because.</div>
          <div class="scene">${sceneSVG("me")}</div>
          <div class="turn">
            <div class="tTitle">üé§ Your Turn</div>
            <ul>
              <li>Sentence 1: name + age</li>
              <li>Sentence 2: school + because</li>
            </ul>
          </div>
        </div>
      `;
    }
  },

  // 4) Personal vocab (6)
  {
    title:"Words ¬∑ Me (1)",
    stage:"Words",
    rightMeta:"Me (1/2)",
    left:(root)=>{
      root.innerHTML = `
        <div class="card">
          <h2>Words: Me</h2>
          <div class="sub">Tap a card ‚Üí teacher asks ‚Üí you answer.</div>
          <div class="grid" id="pv1"></div>
          <div class="turn">
            <div class="tTitle">üé§ Your Turn</div>
            <ul>
              <li>Pick 3 cards ‚Üí answer 3 times</li>
              <li>2 sentences each time</li>
            </ul>
          </div>
        </div>
      `;
    },
    right:(root)=>{
      root.innerHTML = `
        <div class="card soft">
          <h2>Mini rule</h2>
          <div class="scene" style="min-height:220px">
            <div style="max-width:780px;width:100%">
              <div style="background:rgba(255,255,255,.86);border:1px solid rgba(30,42,68,.10);padding:14px;border-radius:18px;font-size:18px;line-height:1.7">
                Answer + Detail<br>
                ‚ÄúMy name is ___. Nice to meet you.‚Äù
              </div>
            </div>
          </div>
        </div>
      `;
    },
    onMount:()=>{
      const host=document.getElementById('pv1'); host.innerHTML="";
      personalCore12.slice(0,6).forEach(x=>host.appendChild(tileCard(x,"Me")));
    }
  },

  // 5) Personal vocab (6)
  {
    title:"Words ¬∑ Me (2)",
    stage:"Words",
    rightMeta:"Me (2/2)",
    left:(root)=>{
      root.innerHTML=`
        <div class="card">
          <h2>Words: Me</h2>
          <div class="sub">Tap a card ‚Üí answer with your info.</div>
          <div class="grid" id="pv2"></div>
          <div class="turn">
            <div class="tTitle">üé§ Your Turn</div>
            <ul>
              <li>Answer: ‚ÄúWhere do you live?‚Äù (2 sentences)</li>
              <li>Answer: ‚ÄúFree time?‚Äù (2 sentences + because)</li>
            </ul>
          </div>
        </div>
      `;
    },
    right:(root)=>{
      root.innerHTML=`
        <div class="card soft">
          <h2>Quick fix</h2>
          <div class="sub"><b>live in</b> = place ¬∑ <b>live with</b> = people</div>
          <div class="scene" style="min-height:200px">
            <div style="max-width:780px;width:100%;display:flex;gap:10px;flex-wrap:wrap">
              <div style="flex:1;min-width:240px;background:rgba(77,150,255,.10);border:1px solid rgba(77,150,255,.20);padding:12px;border-radius:18px;font-size:18px">
                I live in ___.
              </div>
              <div style="flex:1;min-width:240px;background:rgba(34,197,94,.10);border:1px solid rgba(34,197,94,.20);padding:12px;border-radius:18px;font-size:18px">
                I live with ___.
              </div>
            </div>
          </div>
        </div>
      `;
    },
    onMount:()=>{
      const host=document.getElementById('pv2'); host.innerHTML="";
      personalCore12.slice(6,12).forEach(x=>host.appendChild(tileCard(x,"Me")));
    }
  },

  // 6) School vocab (6)
  {
    title:"Words ¬∑ School (1)",
    stage:"Words",
    rightMeta:"School (1/3)",
    left:(root)=>{
      root.innerHTML=`
        <div class="card">
          <h2>Words: School</h2>
          <div class="sub">Tap ‚Üí answer 2 sentences.</div>
          <div class="grid" id="sv1"></div>
          <div class="turn">
            <div class="tTitle">üé§ Your Turn</div>
            <ul>
              <li>Pick 2 cards ‚Üí answer 2 times</li>
              <li>Add 1 power word</li>
            </ul>
          </div>
        </div>
      `;
    },
    right:(root)=>{
      root.innerHTML=`
        <div class="card soft">
          <h2>Picture</h2>
          <div class="scene">${sceneSVG("school")}</div>
          <div class="turn">
            <div class="tTitle">üé§ Your Turn</div>
            <ul><li>Say 2 sentences about your classroom.</li></ul>
          </div>
        </div>
      `;
    },
    onMount:()=>{
      const host=document.getElementById('sv1'); host.innerHTML="";
      schoolCore16.slice(0,6).forEach(x=>host.appendChild(tileCard(x,"School")));
    }
  },

  // 7) School vocab (5)
  {
    title:"Words ¬∑ School (2)",
    stage:"Words",
    rightMeta:"School (2/3)",
    left:(root)=>{
      root.innerHTML=`
        <div class="card">
          <h2>Words: School</h2>
          <div class="sub">Tap ‚Üí teacher asks ‚Üí you answer.</div>
          <div class="grid" id="sv2"></div>
          <div class="turn">
            <div class="tTitle">üé§ Your Turn</div>
            <ul>
              <li>Answer: ‚ÄúWhat subjects do you study?‚Äù</li>
              <li>Use ‚Äúand‚Äù</li>
            </ul>
          </div>
        </div>
      `;
    },
    right:(root)=>{
      root.innerHTML=`
        <div class="card soft">
          <h2>Model</h2>
          <div class="scene" style="min-height:220px">
            <div style="max-width:780px;width:100%">
              <div style="background:rgba(251,191,36,.14);border:1px solid rgba(251,191,36,.22);padding:14px;border-radius:18px;font-size:18px;line-height:1.7">
                I study English, maths and science.<br>
                English is my favourite because it‚Äôs useful.
              </div>
            </div>
          </div>
        </div>
      `;
    },
    onMount:()=>{
      const host=document.getElementById('sv2'); host.innerHTML="";
      schoolCore16.slice(6,11).forEach(x=>host.appendChild(tileCard(x,"School")));
    }
  },

  // 8) School vocab (5)
  {
    title:"Words ¬∑ School (3)",
    stage:"Words",
    rightMeta:"School (3/3)",
    left:(root)=>{
      root.innerHTML=`
        <div class="card">
          <h2>Words: School</h2>
          <div class="sub">Tap ‚Üí speak 2 sentences.</div>
          <div class="grid" id="sv3"></div>
          <div class="turn">
            <div class="tTitle">üé§ Your Turn</div>
            <ul>
              <li>Say 2 sentences about after school</li>
              <li>Use: club / homework</li>
            </ul>
          </div>
        </div>
      `;
    },
    right:(root)=>{
      root.innerHTML=`
        <div class="card soft">
          <h2>Power Words</h2>
          <div class="sub">Click 2 ‚Üí say 2 sentences.</div>
          <div class="scene" style="min-height:220px">
            <div class="grid" id="pwGrid"></div>
          </div>
        </div>
      `;
    },
    onMount:()=>{
      const host=document.getElementById('sv3'); host.innerHTML="";
      schoolCore16.slice(11,16).forEach(x=>host.appendChild(tileCard(x,"School")));
      const pw=document.getElementById('pwGrid'); pw.innerHTML="";
      powerUp10.forEach((w,i)=>{
        const b=document.createElement('div');
        b.className="tile";
        b.style.minHeight="82px";
        b.innerHTML=`
          <div class="front">
            <div class="w">
              ${svgIcon("bolt")}
              <div>
                <div class="word">${w}</div>
                <div class="hint">Tap ‚Üí use it</div>
              </div>
            </div>
          </div>
          <div class="back">
            <div class="mini"><b>Say:</b></div>
            <div class="hint">My school is <b>${w}</b> because ___.</div>
          </div>
        `;
        b.onclick=()=>b.classList.toggle('on');
        pw.appendChild(b);
      });
    }
  },

  // 9) Chunks (3)
  {
    title:"Chunks (1)",
    stage:"Chunks",
    rightMeta:"Speak fast",
    left:(root)=>{
      root.innerHTML=`
        <div class="card">
          <h2>Chunks</h2>
          <div class="sub">Tap ‚Üí say it ‚Üí add 1 detail sentence.</div>
          <div class="grid" id="ch1"></div>
          <div class="turn">
            <div class="tTitle">üé§ Your Turn</div>
            <ul>
              <li>Choose 2 chunks ‚Üí speak 4 sentences</li>
              <li>Use because once</li>
            </ul>
          </div>
        </div>
      `;
    },
    right:(root)=>{
      root.innerHTML=`
        <div class="card soft">
          <h2>Mini challenge</h2>
          <div class="sub">Say 3 sentences about your day.</div>
          <div class="scene">${sceneSVG("school")}</div>
        </div>
      `;
    },
    onMount:()=>{
      const host=document.getElementById('ch1'); host.innerHTML="";
      chunks.slice(0,3).forEach(x=>{
        host.appendChild(tileCard({w:x.w, ic:x.ic, q:"Try:", a:x.model},"Chunk"));
      });
    }
  },

  // 10) Chunks (3)
  {
    title:"Chunks (2)",
    stage:"Chunks",
    rightMeta:"Speak fast",
    left:(root)=>{
      root.innerHTML=`
        <div class="card">
          <h2>Chunks</h2>
          <div class="sub">Tap ‚Üí say it ‚Üí add 1 detail.</div>
          <div class="grid" id="ch2"></div>
          <div class="turn">
            <div class="tTitle">üé§ Your Turn</div>
            <ul>
              <li>Use ‚Äúget along with my classmates‚Äù</li>
              <li>Add because</li>
            </ul>
          </div>
        </div>
      `;
    },
    right:(root)=>{
      root.innerHTML=`
        <div class="card soft">
          <h2>Random chunk</h2>
          <div class="sub">Click ‚Üí speak 2 sentences.</div>
          <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:10px">
            <button class="blue" onclick="pickChunk()">Pick</button>
            <button onclick="pickChunk()">Again</button>
          </div>
          <div id="chunkBox" class="scene" style="min-height:200px"></div>
        </div>
      `;
    },
    onMount:()=>{
      const host=document.getElementById('ch2'); host.innerHTML="";
      chunks.slice(3,6).forEach(x=>{
        host.appendChild(tileCard({w:x.w, ic:x.ic, q:"Try:", a:x.model},"Chunk"));
      });
      pickChunk();
    }
  },

  // 11‚Äì14) Key sentences (12 split into 4 slides √ó3)
  ...[0,3,6,9].map((start,idx)=>({
    title:`Key Sentences (${idx+1})`,
    stage:"Sentences",
    rightMeta:`${start+1}‚Äì${start+3} / 12`,
    left:(root)=>{
      root.innerHTML=`
        <div class="card">
          <h2>Key Sentences</h2>
          <div class="sub">Tap ‚Üí try it ‚Üí change the blanks.</div>
          <div class="grid" id="ks_${idx}"></div>
          <div class="turn">
            <div class="tTitle">üé§ Your Turn</div>
            <ul>
              <li>Choose 2 sentences ‚Üí speak 4 sentences (add details)</li>
              <li>Use because if you can</li>
            </ul>
          </div>
        </div>
      `;
    },
    right:(root)=>{
      root.innerHTML=`
        <div class="card soft">
          <h2>Because √ó2</h2>
          <div class="scene" style="min-height:220px">
            <div style="max-width:780px;width:100%">
              <div style="background:rgba(251,191,36,.14);border:1px solid rgba(251,191,36,.22);padding:14px;border-radius:18px;font-size:18px;line-height:1.7">
                My favourite subject is ___ because ___.<br>
                And because ___.
              </div>
            </div>
          </div>
          <div class="mini">Try to say 2 reasons.</div>
        </div>
      `;
    },
    onMount:()=>{
      const host=document.getElementById(`ks_${idx}`); host.innerHTML="";
      keySentences12.slice(start,start+3).forEach(s=>host.appendChild(sentenceTile(s,"Sentence")));
    }
  })),

  // 15‚Äì17) High-score (6 split into 3 slides √ó2)
  ...[0,2,4].map((start,idx)=>({
    title:`High-score (${idx+1})`,
    stage:"High-score",
    rightMeta:`${start+1}‚Äì${start+2} / 6`,
    left:(root)=>{
      root.innerHTML=`
        <div class="card">
          <h2>High-score Lines</h2>
          <div class="sub">Tap ‚Üí say it ‚Üí add 1 more sentence.</div>
          <div class="grid" id="hs_${idx}"></div>
          <div class="turn">
            <div class="tTitle">üé§ Your Turn</div>
            <ul>
              <li>Use 1 high-score line + 1 detail sentence</li>
              <li>Try to sound confident üôÇ</li>
            </ul>
          </div>
        </div>
      `;
    },
    right:(root)=>{
      root.innerHTML=`
        <div class="card soft">
          <h2>Upgrade tip</h2>
          <div class="scene" style="min-height:220px">
            <div style="max-width:780px;width:100%">
              <div style="background:rgba(34,197,94,.10);border:1px solid rgba(34,197,94,.20);padding:14px;border-radius:18px;font-size:18px;line-height:1.7">
                Add a detail:<br>
                ‚ÄúIt helps me ‚Ä¶‚Äù / ‚ÄúI feel ‚Ä¶‚Äù
              </div>
            </div>
          </div>
        </div>
      `;
    },
    onMount:()=>{
      const host=document.getElementById(`hs_${idx}`); host.innerHTML="";
      highScore6.slice(start,start+2).forEach(s=>host.appendChild(sentenceTile(s,"High")));
    }
  })),

  // 18) Dialogue practice (personal)
  {
    title:"Dialogue ¬∑ Me",
    stage:"Dialogue",
    rightMeta:"3 questions",
    left:(root)=>{
      root.innerHTML=`
        <div class="card">
          <h2>Dialogue: Me</h2>
          <div class="sub">Teacher asks ‚Üí you answer (2 sentences).</div>

          <div class="chat">
            <div class="bubble t">What‚Äôs your name?</div>
            <div class="bubble s">Your answer (2 sentences)</div>

            <div class="bubble t">How old are you?</div>
            <div class="bubble s">Your answer (2 sentences)</div>

            <div class="bubble t">Where do you live?</div>
            <div class="bubble s">Your answer (2 sentences)</div>
          </div>

          <div class="turn">
            <div class="tTitle">üé§ Your Turn</div>
            <ul>
              <li>Do the 3 Qs with the teacher</li>
              <li>Add 1 because if possible</li>
            </ul>
          </div>
        </div>
      `;
    },
    right:(root)=>{
      root.innerHTML=`
        <div class="card soft">
          <h2>Samples (tap)</h2>
          <div class="grid" id="qaMe"></div>
        </div>
      `;
    },
    onMount:()=>{
      const host=document.getElementById('qaMe'); host.innerHTML="";
      examPersonal6.slice(0,3).forEach(x=>host.appendChild(qaCard(x,"Sample")));
    }
  },

  // 19) Dialogue practice (school)
  {
    title:"Dialogue ¬∑ School",
    stage:"Dialogue",
    rightMeta:"3 questions",
    left:(root)=>{
      root.innerHTML=`
        <div class="card">
          <h2>Dialogue: School</h2>
          <div class="sub">Teacher asks ‚Üí you answer (2 sentences).</div>

          <div class="chat">
            <div class="bubble t">What school do you go to?</div>
            <div class="bubble s">Your answer (2 sentences)</div>

            <div class="bubble t">What subjects do you study?</div>
            <div class="bubble s">Your answer (2 sentences)</div>

            <div class="bubble t">What‚Äôs your favourite subject? Why?</div>
            <div class="bubble s">Your answer (2 sentences + because √ó2)</div>
          </div>

          <div class="turn">
            <div class="tTitle">üé§ Your Turn</div>
            <ul>
              <li>Say your favourite subject</li>
              <li>Give 2 reasons (because √ó2)</li>
            </ul>
          </div>
        </div>
      `;
    },
    right:(root)=>{
      root.innerHTML=`
        <div class="card soft">
          <h2>Samples (tap)</h2>
          <div class="grid" id="qaSchool"></div>
        </div>
      `;
    },
    onMount:()=>{
      const host=document.getElementById('qaSchool'); host.innerHTML="";
      examSchool6.slice(0,3).forEach(x=>host.appendChild(qaCard(x,"Sample")));
    }
  },

  // 20) Exam question cards (6 school + 6 personal, split)
  {
    title:"Exam Q Cards (Me)",
    stage:"Exam Practice",
    rightMeta:"6 questions",
    left:(root)=>{
      root.innerHTML=`
        <div class="card">
          <h2>Exam Cards: Me</h2>
          <div class="sub">Tap ‚Üí see sample ‚Üí answer with your info.</div>
          <div class="grid" id="exMe"></div>
          <div class="turn">
            <div class="tTitle">üé§ Your Turn</div>
            <ul>
              <li>Pick any 3 cards</li>
              <li>Answer 2 sentences each</li>
            </ul>
          </div>
        </div>
      `;
    },
    right:(root)=>{
      root.innerHTML=`
        <div class="card soft">
          <h2>Quick spinner</h2>
          <div class="sub">Click ‚Üí new question (answer fast).</div>
          <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:10px">
            <button class="blue" onclick="spinQ('spinBox', examPersonal6)">Pick</button>
            <button onclick="spinQ('spinBox', examPersonal6)">Again</button>
          </div>
          <div id="spinBox" class="scene" style="min-height:220px"></div>
        </div>
      `;
    },
    onMount:()=>{
      const host=document.getElementById('exMe'); host.innerHTML="";
      examPersonal6.forEach(x=>host.appendChild(qaCard(x,"KET")));
      spinQ('spinBox', examPersonal6);
    }
  },

  {
    title:"Exam Q Cards (School)",
    stage:"Exam Practice",
    rightMeta:"6 questions",
    left:(root)=>{
      root.innerHTML=`
        <div class="card">
          <h2>Exam Cards: School</h2>
          <div class="sub">Tap ‚Üí sample ‚Üí answer with your info.</div>
          <div class="grid" id="exSchool"></div>
          <div class="turn">
            <div class="tTitle">üé§ Your Turn</div>
            <ul>
              <li>Pick any 3 cards</li>
              <li>One answer must use because √ó2</li>
            </ul>
          </div>
        </div>
      `;
    },
    right:(root)=>{
      root.innerHTML=`
        <div class="card soft">
          <h2>Quick spinner</h2>
          <div class="sub">Click ‚Üí new question (answer fast).</div>
          <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:10px">
            <button class="blue" onclick="spinQ('spinBox2', examSchool6)">Pick</button>
            <button onclick="spinQ('spinBox2', examSchool6)">Again</button>
          </div>
          <div id="spinBox2" class="scene" style="min-height:220px"></div>
        </div>
      `;
    },
    onMount:()=>{
      const host=document.getElementById('exSchool'); host.innerHTML="";
      examSchool6.forEach(x=>host.appendChild(qaCard(x,"KET")));
      spinQ('spinBox2', examSchool6);
    }
  },

  // 22) Speaking map (logic)
  {
    title:"Speaking Map",
    stage:"Speaking Map",
    rightMeta:"7 steps",
    left:(root)=>{
      root.innerHTML=`
        <div class="card">
          <h2>The Speaking Map</h2>
          <div class="sub">Follow the order. One sentence each step.</div>
          <div class="scene" style="min-height:250px">
            <div style="max-width:820px;width:100%;display:grid;gap:10px">
              ${[
                "1) Name + Age",
                "2) Home (live in / live with / from)",
                "3) School (I study at‚Ä¶)",
                "4) Favourite subject (because √ó2)",
                "5) Break time / After school",
                "6) Good at / Interested in",
                "7) Feeling (I feel‚Ä¶)"
              ].map(x=>`<div style="background:rgba(77,150,255,.08);border:1px solid rgba(77,150,255,.16);padding:12px;border-radius:18px;font-size:18px">${x}</div>`).join("")}
            </div>
          </div>
          <div class="turn">
            <div class="tTitle">üé§ Your Turn</div>
            <ul>
              <li>Say step 1 ‚Üí step 7</li>
              <li>Step 4: because √ó2</li>
            </ul>
          </div>
        </div>
      `;
    },
    right:(root)=>{
      root.innerHTML=`
        <div class="card soft">
          <h2>Sentence counter</h2>
          <div class="sub">Tap when you say each sentence.</div>
          <div class="dots" id="mapDots"></div>
          <div class="scene" style="min-height:190px">${sceneSVG("me")}</div>
        </div>
      `;
    },
    onMount:()=>{
      const d=document.getElementById('mapDots'); d.innerHTML="";
      for(let i=1;i<=7;i++){
        const x=document.createElement('div');
        x.className='dotC'; x.textContent=i;
        x.onclick=()=>x.classList.toggle('on');
        d.appendChild(x);
      }
    }
  },

  // 23) Picture spinner (many repetitions)
  {
    title:"Picture Spinner",
    stage:"Practice",
    rightMeta:"2 sentences each",
    left:(root)=>{
      root.innerHTML=`
        <div class="card">
          <h2>Picture Spinner</h2>
          <div class="sub">Click spin ‚Üí speak 2 sentences.</div>
          <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:10px">
            <button class="primary" onclick="spinPic()">Spin</button>
            <button onclick="spinPic()">Again</button>
          </div>
          <div id="picLabel" class="mini" style="margin-top:10px">Click Spin.</div>
          <div id="picStage" class="scene" style="min-height:260px"></div>
          <div class="turn">
            <div class="tTitle">üé§ Your Turn</div>
            <ul>
              <li>Sentence 1: ‚ÄúThis is the ___.‚Äù / ‚ÄúI go to the ___.‚Äù</li>
              <li>Sentence 2: ‚ÄúI like it because ___.‚Äù</li>
            </ul>
          </div>
        </div>
      `;
    },
    right:(root)=>{
      root.innerHTML=`
        <div class="card soft">
          <h2>Bonus words</h2>
          <div class="sub">Use 1 power word.</div>
          <div class="scene" style="min-height:220px">
            <div id="bonusPW" style="display:flex;gap:10px;flex-wrap:wrap"></div>
          </div>
        </div>
      `;
    },
    onMount:()=>{
      const box=document.getElementById('bonusPW'); box.innerHTML="";
      ["friendly","interesting","useful","comfortable","popular"].forEach((w,i)=>{
        const b=document.createElement('button');
        b.className = (i%2===0) ? "blue" : "pink";
        b.textContent = w;
        box.appendChild(b);
      });
      spinPic();
    }
  },

  // 24) Build-a-sentence (tap tiles, no typing)
  {
    title:"Build a Sentence",
    stage:"Practice",
    rightMeta:"Tap tiles",
    left:(root)=>{
      root.innerHTML=`
        <div class="card">
          <h2>Build a sentence</h2>
          <div class="sub">Tap tiles ‚Üí read it ‚Üí add 1 detail sentence.</div>

          <div class="scene" style="min-height:180px">
            <div style="max-width:860px;width:100%">
              <div class="mini"><b>Sentence</b> (tap a word to remove)</div>
              <div id="buildLine" style="display:flex;flex-wrap:wrap;gap:8px;margin-top:10px;min-height:52px;
                padding:12px;border-radius:18px;border:1px dashed rgba(30,42,68,.18);background:rgba(255,255,255,.86)"></div>

              <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:10px">
                <button class="blue" onclick="buildRandom()">Random</button>
                <button onclick="buildUndo()">Undo</button>
                <button class="pink" onclick="buildClear()">Clear</button>
              </div>
            </div>
          </div>

          <div class="turn">
            <div class="tTitle">üé§ Your Turn</div>
            <ul>
              <li>Read your sentence</li>
              <li>Add 1 detail sentence</li>
              <li>Try because √ó2</li>
            </ul>
          </div>
        </div>
      `;
    },
    right:(root)=>{
      root.innerHTML=`
        <div class="card soft">
          <h2>Tiles</h2>
          <div class="mini">Tap to add</div>
          <div id="tiles" style="display:flex;flex-wrap:wrap;gap:10px;margin-top:10px"></div>
        </div>
      `;
    },
    onMount:()=>{
      mountBuildTiles();
      buildClear();
    }
  },

  // 25) Timer rehearsal (30s)
  {
    title:"Timer ¬∑ 30s",
    stage:"Timed Practice",
    rightMeta:"Rehearsal",
    left:(root)=>{
      root.innerHTML=`
        <div class="card">
          <h2>Timer: 30 seconds</h2>
          <div class="sub">Speak without stopping.</div>

          <div class="timerWrap">
            <div class="ring" id="ringA" style="--deg:0deg">
              <div class="timeBox">
                <p class="num" id="tNumA">30</p>
                <p class="lab">seconds</p>
              </div>
            </div>
            <div>
              <div style="display:flex;gap:10px;flex-wrap:wrap">
                <button class="primary" onclick="startTimer('A',30)">Start</button>
                <button onclick="pauseTimer('A')">Pause</button>
                <button class="pink" onclick="resetTimer('A')">Reset</button>
              </div>

              <div class="turn">
                <div class="tTitle">üé§ Your Turn</div>
                <ul>
                  <li>4‚Äì5 sentences</li>
                  <li>because √ó1</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      `;
    },
    right:(root)=>{
      root.innerHTML=`
        <div class="card soft">
          <h2>Rescue words</h2>
          <div class="scene" style="min-height:220px">
            <div style="max-width:780px;width:100%">
              <div style="background:rgba(77,150,255,.10);border:1px solid rgba(77,150,255,.20);padding:14px;border-radius:18px;font-size:18px;line-height:1.7">
                Let me think‚Ä¶<br>
                Also,‚Ä¶ / And‚Ä¶ / Then‚Ä¶<br>
                because‚Ä¶
              </div>
            </div>
          </div>
        </div>
      `;
    }
  },

  // 26) Final timer (40/50)
  {
    title:"Final Output",
    stage:"Final Output",
    rightMeta:"40‚Äì50 seconds",
    left:(root)=>{
      root.innerHTML=`
        <div class="card">
          <h2>Final: 40‚Äì50 seconds</h2>
          <div class="sub">6+ sentences ¬∑ because √ó2</div>

          <div class="timerWrap">
            <div class="ring" id="ringB" style="--deg:0deg">
              <div class="timeBox">
                <p class="num" id="tNumB">40</p>
                <p class="lab">seconds</p>
              </div>
            </div>
            <div>
              <div style="display:flex;gap:10px;flex-wrap:wrap">
                <button class="primary" onclick="startTimer('B',40)">Start 40</button>
                <button class="blue" onclick="startTimer('B',50)">Start 50</button>
                <button onclick="pauseTimer('B')">Pause</button>
                <button class="pink" onclick="resetTimer('B')">Reset</button>
              </div>

              <div class="turn">
                <div class="tTitle">üé§ Your Turn</div>
                <ul>
                  <li>6+ sentences</li>
                  <li>because √ó2</li>
                  <li>Use 1 high-score line</li>
                </ul>
              </div>

              <div class="dots" id="finalDots"></div>
              <div class="mini" style="margin-top:8px">Tap dots: sentence counter.</div>
            </div>
          </div>
        </div>
      `;
    },
    right:(root)=>{
      root.innerHTML=`
        <div class="card soft">
          <h2>Quick checklist</h2>
          <div class="scene" style="min-height:250px">
            <div style="max-width:760px;width:100%;display:grid;gap:10px">
              ${[
                "‚úÖ name + age",
                "‚úÖ home",
                "‚úÖ school",
                "‚úÖ favourite subject (because √ó2)",
                "‚úÖ after school",
                "‚úÖ feeling"
              ].map(x=>`<div style="background:rgba(255,255,255,.86);border:1px solid rgba(30,42,68,.10);padding:12px;border-radius:18px;font-size:18px">${x}</div>`).join("")}
            </div>
          </div>
        </div>
      `;
    },
    onMount:()=>{
      const d=document.getElementById('finalDots'); d.innerHTML="";
      for(let i=1;i<=8;i++){
        const x=document.createElement('div');
        x.className='dotC'; x.textContent=i;
        x.onclick=()=>x.classList.toggle('on');
        d.appendChild(x);
      }
    }
  },

  // 27) End
  {
    title:"Bye",
    stage:"End",
    rightMeta:"See you!",
    one:true,
    left:(root)=>{
      root.innerHTML=`
        <div class="card">
          <h1>üéâ Great job!</h1>
          <div class="sub">You spoke a lot today.</div>
          <div class="scene">${sceneSVG("cover")}</div>
          <div class="turn">
            <div class="tTitle">üé§ Your Turn</div>
            <ul>
              <li>Say: ‚ÄúThank you!‚Äù</li>
              <li>Say: ‚ÄúBye!‚Äù</li>
            </ul>
          </div>
        </div>
      `;
    }
  }
];

/* ============ RENDER SLIDES + NAV ============ */
const deck = document.getElementById('deck');
const slides = [];

slideDefs.forEach(def=>{
  const {s, wrap} = slideShell({title:def.title, stage:def.stage, rightMeta:def.rightMeta, one:!!def.one});
  if(def.one){
    const left = document.createElement('div'); left.className='slot';
    wrap.appendChild(left); def.left(left);
  }else{
    const left = document.createElement('div'); left.className='slot';
    const right = document.createElement('div'); right.className='slot';
    wrap.appendChild(left); wrap.appendChild(right);
    def.left(left); def.right && def.right(right);
  }
  deck.appendChild(s);
  slides.push({el:s, title:def.title, stage:def.stage, onMount:def.onMount || null});
});

// Bottom nav
const nav = document.createElement('div');
nav.id="nav";
nav.innerHTML = `
  <button class="navBtn secondary" id="prev">‚¨Ö Prev</button>
  <div class="center">
    <span id="navTitle"></span>
    <div class="progress"><div class="bar" id="bar"></div></div>
    <span id="count"></span>
  </div>
  <button class="navBtn" id="next">Next ‚û°</button>
`;
deck.appendChild(nav);

let idx=0;
function show(i){
  idx = Math.max(0, Math.min(slides.length-1, i));
  slides.forEach((s,k)=>s.el.classList.toggle('active', k===idx));

  const c = slides[idx].el.querySelector('[data-count]');
  if(c) c.textContent = `${idx+1} / ${slides.length}`;

  document.getElementById('navTitle').textContent = slides[idx].title;
  document.getElementById('count').textContent = `${idx+1} / ${slides.length}`;
  document.getElementById('prev').disabled = idx===0;
  document.getElementById('next').disabled = idx===slides.length-1;

  const pct = ((idx+1)/slides.length)*100;
  document.getElementById('bar').style.width = pct+'%';

  if(slides[idx].onMount) slides[idx].onMount();
}
document.getElementById('prev').onclick=()=>show(idx-1);
document.getElementById('next').onclick=()=>show(idx+1);

window.addEventListener('keydown',(e)=>{
  const k=e.key.toLowerCase();
  if(k==='arrowright' || k===' ' || k==='d') show(idx+1);
  if(k==='arrowleft' || k==='a') show(idx-1);
  if(k==='m') togglePicker(true);
  if(k==='escape') togglePicker(false);
});

// swipe
let sx=null;
window.addEventListener('touchstart', e=>sx=e.changedTouches[0].clientX, {passive:true});
window.addEventListener('touchend', e=>{
  if(sx===null) return;
  const dx = e.changedTouches[0].clientX - sx;
  if(dx < -50) show(idx+1);
  if(dx > 50) show(idx-1);
  sx=null;
},{passive:true});

show(0);

/* ============ MENU PICKER ============ */
const picker=document.getElementById('picker');
const pickerList=document.getElementById('pickerList');
slides.forEach((s,i)=>{
  const b=document.createElement('div');
  b.className='jump';
  b.innerHTML=`<b>${i+1}. ${s.title}</b><small>${s.stage}</small>`;
  b.onclick=()=>{show(i); togglePicker(false);};
  pickerList.appendChild(b);
});
window.togglePicker=function(on){
  picker.classList.toggle('on', !!on);
  picker.setAttribute('aria-hidden', on ? 'false' : 'true');
};

/* ============ RANDOM CHUNK ============ */
window.pickChunk=function(){
  const box=document.getElementById('chunkBox');
  if(!box) return;
  const pick = chunks[Math.floor(Math.random()*chunks.length)];
  box.innerHTML = `
    <div style="max-width:800px;width:100%">
      <div style="background:rgba(255,255,255,.86);border:1px solid rgba(30,42,68,.10);padding:14px;border-radius:18px;font-size:18px;line-height:1.7">
        <b>${pick.w}</b><br>${pick.model}<br><span style="color:var(--mut);font-size:14px">+ one more detail sentence</span>
      </div>
    </div>
  `;
};

/* ============ QUESTION SPINNER ============ */
window.spinQ=function(targetId, list){
  const el=document.getElementById(targetId);
  if(!el) return;
  const q = list[Math.floor(Math.random()*list.length)];
  el.innerHTML=`
    <div style="max-width:820px;width:100%">
      <div style="background:rgba(255,255,255,.86);border:1px solid rgba(30,42,68,.10);padding:16px;border-radius:18px;font-size:20px">
        ${q.q}
      </div>
      <div class="mini" style="margin-top:10px">Answer 2 sentences (2nd = detail).</div>
    </div>
  `;
};

/* ============ PICTURE SPINNER ============ */
const picScenes = [
  {label:"SCHOOL", svg: sceneSVG("cover")},
  {label:"CLASSROOM", svg: sceneSVG("school")},
  {label:"LIBRARY", svg: sceneSVG("school")},
  {label:"CLUB", svg: `<svg viewBox="0 0 900 260" width="100%" height="240" role="img" aria-label="club">
    <rect width="900" height="260" rx="26" fill="rgba(255,255,255,.72)"/>
    <g transform="translate(220,70)">
      <rect x="0" y="0" width="460" height="150" rx="22" fill="rgba(251,113,133,.12)" stroke="rgba(251,113,133,.22)"/>
      <circle cx="160" cy="74" r="22" fill="#fff" opacity=".95"/>
      <circle cx="230" cy="62" r="22" fill="#fff" opacity=".95"/>
      <circle cx="300" cy="74" r="22" fill="#fff" opacity=".95"/>
      <rect x="140" y="104" width="220" height="34" rx="17" fill="#fff" opacity=".92"/>
      <text x="230" y="128" text-anchor="middle" font-size="18" fill="#1E2A44">club</text>
    </g>
  </svg>`},
  {label:"BREAK TIME", svg: `<svg viewBox="0 0 900 260" width="100%" height="240" role="img" aria-label="break time">
    <rect width="900" height="260" rx="26" fill="rgba(255,255,255,.72)"/>
    <g transform="translate(230,60)">
      <rect x="0" y="0" width="440" height="170" rx="24" fill="rgba(251,191,36,.14)" stroke="rgba(251,191,36,.26)"/>
      <g transform="translate(95,62)">
        <circle cx="0" cy="0" r="24" fill="#fff" stroke="rgba(30,42,68,.12)"/>
        <circle cx="-7" cy="-6" r="3" fill="#1E2A44"/><circle cx="7" cy="-6" r="3" fill="#1E2A44"/>
        <path d="M-10 8 Q0 16 10 8" fill="none" stroke="#1E2A44" stroke-width="4" stroke-linecap="round"/>
      </g>
      <g transform="translate(220,62)">
        <circle cx="0" cy="0" r="24" fill="#fff" stroke="rgba(30,42,68,.12)"/>
        <circle cx="-7" cy="-6" r="3" fill="#1E2A44"/><circle cx="7" cy="-6" r="3" fill="#1E2A44"/>
        <path d="M-10 8 Q0 16 10 8" fill="none" stroke="#1E2A44" stroke-width="4" stroke-linecap="round"/>
      </g>
      <g transform="translate(345,62)">
        <circle cx="0" cy="0" r="24" fill="#fff" stroke="rgba(30,42,68,.12)"/>
        <circle cx="-7" cy="-6" r="3" fill="#1E2A44"/><circle cx="7" cy="-6" r="3" fill="#1E2A44"/>
        <path d="M-10 8 Q0 16 10 8" fill="none" stroke="#1E2A44" stroke-width="4" stroke-linecap="round"/>
      </g>
      <text x="220" y="142" text-anchor="middle" font-size="18" fill="#1E2A44">break time</text>
    </g>
  </svg>`},
];
window.spinPic=function(){
  const label=document.getElementById('picLabel');
  const stage=document.getElementById('picStage');
  if(!label || !stage) return;
  const p = picScenes[Math.floor(Math.random()*picScenes.length)];
  label.innerHTML = `<b>Picture: ${p.label}</b>`;
  stage.innerHTML = p.svg;
};

/* ============ BUILD-A-SENTENCE (tap tiles) ============ */
const build = {tokens:[]};
const tileBank = [
  "My name is","I‚Äôm","years old","I live in","I live with","I come from",
  "I study at","My school is","My favourite subject is","After school, I often",
  "I do homework at home","I get along with my classmates","I feel",
  "English","maths","science","PE",
  "friendly","helpful","interesting","useful","comfortable","popular",
  "because","and","also","then","when",
  "it helps me speak better","I get good marks","I like games"
];

function mountBuildTiles(){
  const host=document.getElementById('tiles');
  if(!host) return;
  host.innerHTML="";
  tileBank.forEach((t,i)=>{
    const b=document.createElement('button');
    b.className = (t==="because") ? "pink" : (i%3===0 ? "blue" : "");
    b.textContent=t;
    b.onclick=()=>{build.tokens.push(t); renderBuild();};
    host.appendChild(b);
  });
}
function renderBuild(){
  const line=document.getElementById('buildLine');
  if(!line) return;
  line.innerHTML="";
  build.tokens.forEach((t,i)=>{
    const w=document.createElement('button');
    w.textContent=t;
    w.className="pink";
    w.style.padding="10px 12px";
    w.onclick=()=>{build.tokens.splice(i,1); renderBuild();};
    line.appendChild(w);
  });
}
window.buildUndo=()=>{build.tokens.pop(); renderBuild();};
window.buildClear=()=>{build.tokens=[]; renderBuild();};
window.buildRandom=()=>{
  const starters=["My favourite subject is","I study at","After school, I often","My school is"];
  const words=["English","maths","science","PE","Sunshine School"];
  const reasons=["it‚Äôs useful","it‚Äôs interesting","it helps me speak better","I like games","I get good marks"];
  const s=starters[Math.floor(Math.random()*starters.length)];
  const w=words[Math.floor(Math.random()*words.length)];
  const r1=reasons[Math.floor(Math.random()*reasons.length)];
  build.tokens=[s,w,"because",r1];
  if(Math.random()<0.6){
    const r2=reasons[Math.floor(Math.random()*reasons.length)];
    build.tokens.push("and","because",r2);
  }
  renderBuild();
};

/* ============ TIMERS (A & B) ============ */
const timers = {
  A:{running:false,t:30,total:30,raf:null,last:0, ringId:"ringA", numId:"tNumA"},
  B:{running:false,t:40,total:40,raf:null,last:0, ringId:"ringB", numId:"tNumB"},
};

function setRing(which, progress01){
  const ring=document.getElementById(timers[which].ringId);
  if(!ring) return;
  ring.style.setProperty('--deg', (Math.max(0,Math.min(1,progress01))*360)+'deg');
}
window.startTimer=function(which, seconds){
  const T=timers[which];
  T.total=seconds; T.t=seconds; T.running=true; T.last=performance.now();
  const n=document.getElementById(T.numId); if(n) n.textContent=String(seconds);
  setRing(which, 0);
  if(T.raf) cancelAnimationFrame(T.raf);
  T.raf=requestAnimationFrame((now)=>tick(which,now));
};
window.pauseTimer=function(which){ timers[which].running=false; };
window.resetTimer=function(which){
  const T=timers[which]; T.running=false;
  const n=document.getElementById(T.numId); if(n) n.textContent=String(T.total);
  setRing(which, 0);
};

function tick(which, now){
  const T=timers[which];
  T.raf=requestAnimationFrame((n)=>tick(which,n));
  if(!T.running) return;

  const dt=(now-T.last)/1000; T.last=now;
  T.t-=dt;

  const show=Math.max(0, Math.ceil(T.t));
  const n=document.getElementById(T.numId); if(n) n.textContent=String(show);

  const elapsed=T.total - T.t;
  setRing(which, elapsed/T.total);

  if(T.t<=0){ T.running=false; setRing(which,1); }
}
</script>
</body>
</html>
