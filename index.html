<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>KET Speaking 1v1 ¬∑ T1 About Me & School (Student Slides)</title>

  <style>
    :root{
      --bgA:#F6FBFF;
      --bgB:#FFF6FB;
      --ink:#1E2A44;
      --mut:#5A6A86;

      --card:#FFFFFF;
      --stroke: rgba(30,42,68,.12);
      --shadow: 0 18px 40px rgba(30,42,68,.10);

      --blue:#4D96FF;
      --pink:#FB7185;
      --green:#22C55E;
      --purple:#8B5CF6;
      --amber:#FBBF24;

      --r: 24px;
      --pad: 52px;
      --padM: 16px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      color:var(--ink);
      overflow:hidden;
      background:
        radial-gradient(900px 560px at 14% 12%, rgba(77,150,255,.18), transparent 58%),
        radial-gradient(920px 580px at 86% 18%, rgba(251,113,133,.16), transparent 58%),
        radial-gradient(780px 540px at 60% 90%, rgba(34,197,94,.11), transparent 60%),
        linear-gradient(120deg, var(--bgA), var(--bgB));
    }

    /* Deck */
    #deck{height:100vh;width:100vw;position:relative}
    .slide{
      position:absolute; inset:0;
      padding: var(--pad) var(--pad) 92px;
      display:none;
    }
    .slide.active{display:block}
    @media (max-width: 980px){
      .slide{padding:46px var(--padM) 92px}
    }

    /* Header */
    .header{
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      margin-bottom:14px;
    }
    .badge{
      display:inline-flex;align-items:center;gap:10px;
      padding:10px 14px;border-radius:999px;
      background: rgba(255,255,255,.82);
      border:1px solid var(--stroke);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      user-select:none;
      color:var(--mut);
      font-size:14px;
    }
    .badge .dot{
      width:10px;height:10px;border-radius:50%;
      background: linear-gradient(135deg, var(--blue), var(--purple));
      box-shadow: 0 0 0 4px rgba(77,150,255,.16);
    }
    .meta{
      display:flex;align-items:center;gap:10px;flex-wrap:wrap;
      user-select:none;
      color:var(--mut);font-size:14px;
    }
    .pill{
      padding:9px 12px;border-radius:999px;
      background: rgba(255,255,255,.82);
      border:1px solid var(--stroke);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
    }

    /* Layout */
    .wrap{
      height: calc(100vh - 92px - 46px);
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap:16px;
    }
    .wrap.one{grid-template-columns:1fr}
    @media (max-width: 980px){
      .wrap{grid-template-columns:1fr}
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.98), rgba(255,255,255,.92));
      border:1px solid var(--stroke);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      padding:16px 16px 14px;
      overflow:auto;
    }
    .card.soft{
      background: linear-gradient(180deg, rgba(244,248,255,.92), rgba(255,255,255,.92));
    }

    h1{margin:0 0 10px;font-size:36px;letter-spacing:.2px}
    h2{margin:0 0 10px;font-size:26px}
    .sub{color:var(--mut);font-size:16px;line-height:1.55}
    .big{font-size:18px;line-height:1.65}
    .mini{font-size:14px;color:var(--mut);line-height:1.55}

    /* Your Turn */
    .turn{
      margin-top:12px;
      border-radius:18px;
      border:2px dashed rgba(77,150,255,.24);
      background: rgba(255,255,255,.88);
      padding:12px;
    }
    .turn .tTitle{
      display:flex;align-items:center;gap:10px;
      font-size:16px;color:var(--ink);
      margin-bottom:6px;
      user-select:none;
    }
    .turn ul{margin:8px 0 0;padding-left:18px;color:var(--mut);line-height:1.6}

    /* Visual blocks */
    .scene{
      width:100%;
      border-radius:20px;
      border:1px solid var(--stroke);
      box-shadow: var(--shadow);
      background: linear-gradient(120deg, rgba(77,150,255,.10), rgba(251,113,133,.08), rgba(34,197,94,.08));
      overflow:hidden;
      display:grid;
      place-items:center;
      padding:10px;
      margin-top:10px;
      min-height: 210px;
    }

    /* Micro cards (vocab / chunks / frames) */
    .grid6{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:12px;
      margin-top:10px;
    }
    @media (max-width: 980px){ .grid6{grid-template-columns: repeat(2, 1fr)} }

    .tile{
      border-radius:18px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.88);
      box-shadow: 0 12px 26px rgba(30,42,68,.08);
      padding:12px;
      cursor:pointer;
      user-select:none;
      transition: transform .08s ease;
      min-height: 110px;
      position:relative;
      overflow:hidden;
    }
    .tile:active{transform: translateY(1px)}
    .tag{
      position:absolute; top:10px; right:10px;
      padding:6px 10px;border-radius:999px;
      font-size:12px;
      border:1px solid rgba(30,42,68,.12);
      background: rgba(255,255,255,.85);
      color:var(--mut);
    }
    .w{
      display:flex;align-items:flex-start;gap:10px;
    }
    .icon{width:28px;height:28px;flex:0 0 auto}
    .word{font-size:18px;color:var(--ink)}
    .hint{margin-top:8px;color:var(--mut);font-size:14px;line-height:1.5}
    .tile .back{display:none;margin-top:8px}
    .tile.on .front{display:none}
    .tile.on .back{display:block}
    .tile.on{outline: 3px solid rgba(77,150,255,.20)}

    /* Buttons */
    .btnRow{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    button{
      appearance:none;border:none;cursor:pointer;
      padding:12px 14px;border-radius:14px;
      background: rgba(255,255,255,.90);
      border:1px solid var(--stroke);
      color:var(--ink);
      font-size:14px;
      box-shadow: 0 10px 22px rgba(30,42,68,.08);
    }
    button.primary{background: rgba(34,197,94,.14);border-color: rgba(34,197,94,.22)}
    button.blue{background: rgba(77,150,255,.14);border-color: rgba(77,150,255,.22)}
    button.pink{background: rgba(251,113,133,.14);border-color: rgba(251,113,133,.22)}
    button:active{transform: translateY(1px)}

    /* Timer */
    .timerWrap{display:flex;align-items:center;gap:16px;flex-wrap:wrap;margin-top:10px}
    .ring{
      width:240px;height:240px;border-radius:50%;
      background: conic-gradient(var(--blue) var(--deg), rgba(30,42,68,.10) 0);
      border:1px solid var(--stroke);
      box-shadow: var(--shadow);
      display:grid;place-items:center;
      position:relative;
      --deg: 0deg;
    }
    .ring::after{
      content:""; position:absolute; inset:16px; border-radius:50%;
      background: rgba(255,255,255,.92);
      border:1px solid var(--stroke);
    }
    .timeBox{position:relative;z-index:2;text-align:center}
    .timeBox .num{font-size:64px;margin:0}
    .timeBox .lab{font-size:14px;color:var(--mut);margin:0}

    /* Bottom nav */
    #nav{
      position:absolute;left:18px;right:18px;bottom:14px;height:54px;
      border-radius:18px;
      background: rgba(255,255,255,.86);
      border:1px solid var(--stroke);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      display:flex;align-items:center;justify-content:space-between;
      padding:8px 10px; gap:10px;
      user-select:none;
    }
    .navBtn{
      padding:10px 12px;border-radius:14px;
      background: rgba(77,150,255,.12);
      border:1px solid rgba(77,150,255,.20);
      cursor:pointer;
      font-size:14px;
      white-space:nowrap;
    }
    .navBtn.secondary{
      background: rgba(251,113,133,.12);
      border-color: rgba(251,113,133,.20);
    }
    .navBtn:disabled{opacity:.45;cursor:not-allowed}
    .center{
      display:flex;align-items:center;gap:10px;
      min-width: 260px;
      justify-content:center;
      color:var(--mut);
      font-size:14px;
      text-align:center;
      flex:1;
    }
    .progress{
      height:8px; width:220px;
      background: rgba(30,42,68,.10);
      border-radius:999px;
      overflow:hidden;
      border:1px solid rgba(30,42,68,.08);
    }
    .bar{
      height:100%;
      width:0%;
      background: linear-gradient(135deg, var(--blue), var(--purple));
      border-radius:999px;
      transition: width .2s ease;
    }

    /* Slide picker */
    #picker{
      position:fixed; inset:0;
      background: rgba(30,42,68,.26);
      backdrop-filter: blur(10px);
      display:none;
      z-index:999;
      padding:18px;
    }
    #picker.on{display:block}
    .pickerPanel{
      max-width: 980px;
      margin: 0 auto;
      background: rgba(255,255,255,.92);
      border:1px solid var(--stroke);
      border-radius: 22px;
      box-shadow: var(--shadow);
      padding:16px;
      max-height: calc(100vh - 36px);
      overflow:auto;
    }
    .pickerTop{
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      margin-bottom:10px;
    }
    .pickerTop h3{margin:0;font-size:18px;color:var(--ink)}
    .list{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:10px;
    }
    @media (max-width: 980px){ .list{grid-template-columns: repeat(2, 1fr)} }
    .jump{
      padding:12px;border-radius:18px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.88);
      cursor:pointer;
      user-select:none;
    }
    .jump small{display:block;color:var(--mut);margin-top:4px}
  </style>
</head>

<body>
<div id="deck">
  <!-- Slides are generated by JS -->
</div>

<!-- Slide picker overlay -->
<div id="picker" aria-hidden="true">
  <div class="pickerPanel">
    <div class="pickerTop">
      <h3>Jump to a slide</h3>
      <button onclick="togglePicker(false)">Close</button>
    </div>
    <div class="list" id="pickerList"></div>
  </div>
</div>

<script>
/* =========================
   1) Pretty inline SVGs
   ========================= */
function svgIcon(type){
  const s = 'stroke="rgba(30,42,68,.35)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" fill="none"';
  if(type==="tag") return `<svg class="icon" viewBox="0 0 24 24"><path ${s} d="M4 7.5C4 6.1 5.1 5 6.5 5h11C19 5 20 6.1 20 7.5v9C20 17.9 18.9 19 17.5 19h-11C5.1 19 4 17.9 4 16.5v-9Z"/><path d="M7 9h10" stroke="#4D96FF" stroke-width="2.2"/><path d="M7 12h7" stroke="#FB7185" stroke-width="2.2"/></svg>`;
  if(type==="clock") return `<svg class="icon" viewBox="0 0 24 24"><path ${s} d="M12 22a10 10 0 1 0-10-10 10 10 0 0 0 10 10Z"/><path d="M12 6v6l4 2" stroke="#4D96FF" stroke-width="2.2"/></svg>`;
  if(type==="pin") return `<svg class="icon" viewBox="0 0 24 24"><path ${s} d="M12 21s7-4.4 7-10.2A7 7 0 0 0 5 10.8C5 16.6 12 21 12 21Z"/><circle cx="12" cy="11" r="2.6" fill="#22C55E" opacity=".35"/></svg>`;
  if(type==="home") return `<svg class="icon" viewBox="0 0 24 24"><path ${s} d="M3 11l9-7 9 7"/><path ${s} d="M5 10v10h14V10"/><path d="M10 20v-6h4v6" stroke="#FB7185" stroke-width="2.2"/></svg>`;
  if(type==="school") return `<svg class="icon" viewBox="0 0 24 24"><path ${s} d="M4 10.5 12 6l8 4.5v8.2a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-8.2Z"/><path d="M9 20v-6h6v6" stroke="#4D96FF" stroke-width="2.2"/></svg>`;
  if(type==="book") return `<svg class="icon" viewBox="0 0 24 24"><path ${s} d="M6 4h10a2 2 0 0 1 2 2v14H8a2 2 0 0 0-2 2V4Z"/><path d="M8 7h8" stroke="#22C55E" stroke-width="2.2"/></svg>`;
  if(type==="teacher") return `<svg class="icon" viewBox="0 0 24 24"><path ${s} d="M12 12a4 4 0 1 0-4-4 4 4 0 0 0 4 4Z"/><path ${s} d="M4 20a8 8 0 0 1 16 0"/></svg>`;
  if(type==="group") return `<svg class="icon" viewBox="0 0 24 24"><path ${s} d="M16 11a3 3 0 1 0-3-3 3 3 0 0 0 3 3Z"/><path ${s} d="M8 12a3 3 0 1 0-3-3 3 3 0 0 0 3 3Z"/><path ${s} d="M2 20a6 6 0 0 1 10 0"/><path ${s} d="M12 20a6 6 0 0 1 10 0"/></svg>`;
  if(type==="bolt") return `<svg class="icon" viewBox="0 0 24 24"><path ${s} d="M13 2 4 14h7l-1 8 10-12h-7Z"/><path d="M11 14h7" stroke="#FBBF24" stroke-width="2.2"/></svg>`;
  return `<svg class="icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="9" fill="rgba(77,150,255,.18)"/></svg>`;
}

function sceneSVG(kind){
  // Large visuals, very little text.
  if(kind==="cover") return `
  <svg viewBox="0 0 900 260" width="100%" height="240" role="img" aria-label="school scene">
    <defs>
      <linearGradient id="g1" x1="0" x2="1">
        <stop offset="0" stop-color="#4D96FF" stop-opacity=".20"/>
        <stop offset="1" stop-color="#FB7185" stop-opacity=".16"/>
      </linearGradient>
    </defs>
    <rect x="0" y="0" width="900" height="260" rx="26" fill="url(#g1)"/>
    <g fill="#fff" opacity=".86">
      <circle cx="160" cy="70" r="22"/><circle cx="190" cy="62" r="28"/><circle cx="228" cy="72" r="22"/>
      <circle cx="690" cy="80" r="18"/><circle cx="718" cy="72" r="24"/><circle cx="750" cy="82" r="18"/>
    </g>
    <g transform="translate(330,55)">
      <polygon points="120,0 260,70 -20,70" fill="rgba(251,191,36,.42)" stroke="rgba(30,42,68,.12)"/>
      <rect x="0" y="70" width="240" height="150" rx="18" fill="#ffffff" opacity=".92" stroke="rgba(30,42,68,.12)"/>
      <rect x="90" y="120" width="60" height="100" rx="10" fill="rgba(77,150,255,.14)" stroke="rgba(77,150,255,.22)"/>
      <rect x="24" y="100" width="45" height="40" rx="8" fill="rgba(34,197,94,.14)" stroke="rgba(34,197,94,.22)"/>
      <rect x="171" y="100" width="45" height="40" rx="8" fill="rgba(34,197,94,.14)" stroke="rgba(34,197,94,.22)"/>
    </g>
    <g transform="translate(200,170)">
      <circle cx="0" cy="0" r="22" fill="#fff" stroke="rgba(30,42,68,.12)"/>
      <rect x="-18" y="25" width="36" height="50" rx="12" fill="rgba(34,197,94,.70)" stroke="rgba(30,42,68,.10)"/>
      <circle cx="-7" cy="-6" r="3" fill="#1E2A44"/><circle cx="7" cy="-6" r="3" fill="#1E2A44"/>
      <path d="M-8 6 Q0 14 8 6" fill="none" stroke="#1E2A44" stroke-width="3" stroke-linecap="round"/>
    </g>
    <g transform="translate(720,175)">
      <circle cx="0" cy="0" r="22" fill="#fff" stroke="rgba(30,42,68,.12)"/>
      <rect x="-18" y="25" width="36" height="50" rx="12" fill="rgba(139,92,246,.65)" stroke="rgba(30,42,68,.10)"/>
      <circle cx="-7" cy="-6" r="3" fill="#1E2A44"/><circle cx="7" cy="-6" r="3" fill="#1E2A44"/>
      <path d="M-8 6 Q0 14 8 6" fill="none" stroke="#1E2A44" stroke-width="3" stroke-linecap="round"/>
    </g>
  </svg>`;
  if(kind==="personal") return `
  <svg viewBox="0 0 900 260" width="100%" height="240" role="img" aria-label="name & home">
    <rect width="900" height="260" rx="26" fill="rgba(255,255,255,.72)"/>
    <g transform="translate(120,70)">
      <rect x="0" y="0" width="300" height="140" rx="22" fill="rgba(77,150,255,.14)" stroke="rgba(77,150,255,.22)"/>
      <text x="150" y="60" text-anchor="middle" font-size="22" fill="#1E2A44">NAME</text>
      <text x="150" y="98" text-anchor="middle" font-size="16" fill="#5A6A86">My name is‚Ä¶</text>
    </g>
    <g transform="translate(520,62)">
      <polygon points="0,60 90,0 180,60" fill="rgba(251,113,133,.16)" stroke="rgba(251,113,133,.22)"/>
      <rect x="20" y="60" width="140" height="120" rx="18" fill="#fff" stroke="rgba(30,42,68,.10)"/>
      <rect x="72" y="112" width="56" height="68" rx="12" fill="rgba(77,150,255,.12)" stroke="rgba(77,150,255,.20)"/>
    </g>
  </svg>`;
  if(kind==="school") return `
  <svg viewBox="0 0 900 260" width="100%" height="240" role="img" aria-label="classroom & library">
    <rect width="900" height="260" rx="26" fill="rgba(255,255,255,.72)"/>
    <g transform="translate(110,70)">
      <rect x="0" y="0" width="330" height="150" rx="22" fill="rgba(34,197,94,.14)" stroke="rgba(34,197,94,.22)"/>
      <rect x="28" y="28" width="274" height="64" rx="16" fill="#fff" opacity=".92"/>
      <text x="165" y="70" text-anchor="middle" font-size="18" fill="#1E2A44">classroom</text>
      <rect x="60" y="110" width="84" height="34" rx="12" fill="rgba(77,150,255,.14)" stroke="rgba(77,150,255,.22)"/>
      <rect x="156" y="110" width="84" height="34" rx="12" fill="rgba(77,150,255,.14)" stroke="rgba(77,150,255,.22)"/>
      <rect x="252" y="110" width="50" height="34" rx="12" fill="rgba(77,150,255,.14)" stroke="rgba(77,150,255,.22)"/>
    </g>
    <g transform="translate(520,70)">
      <rect x="0" y="0" width="270" height="150" rx="22" fill="rgba(77,150,255,.14)" stroke="rgba(77,150,255,.22)"/>
      <rect x="26" y="30" width="218" height="86" rx="16" fill="#fff" opacity=".92"/>
      <path d="M56 56h158M56 78h158M56 100h158" stroke="#4D96FF" stroke-width="8" stroke-linecap="round"/>
      <text x="135" y="138" text-anchor="middle" font-size="16" fill="#5A6A86">library</text>
    </g>
  </svg>`;
  return `<svg viewBox="0 0 900 260" width="100%" height="240"><rect width="900" height="260" rx="26" fill="rgba(255,255,255,.72)"/></svg>`;
}

/* =========================
   2) Content: fewer items per slide
   (Everything is still covered across slides)
   ========================= */
const powerWords = ["friendly","helpful","strict","interesting","boring","difficult","easy","useful","popular","comfortable"];

const personalCore12 = [
  {w:"name", ic:"tag", q:"What‚Äôs your name?", a:"My name is ___."},
  {w:"full name", ic:"tag", q:"What‚Äôs your full name?", a:"My full name is ___."},
  {w:"call me", ic:"tag", q:"Nickname?", a:"You can call me ___."},
  {w:"age", ic:"clock", q:"How old are you?", a:"I‚Äôm ___ years old."},
  {w:"years old", ic:"clock", q:"Say it!", a:"I‚Äôm ___ years old."},
  {w:"live in", ic:"pin", q:"Where do you live?", a:"I live in ___."},
  {w:"live with", ic:"home", q:"Who do you live with?", a:"I live with ___."},
  {w:"come from", ic:"pin", q:"Where are you from?", a:"I come from ___."},
  {w:"city", ic:"pin", q:"Your city?", a:"My city is ___."},
  {w:"family", ic:"group", q:"Family?", a:"There are ___ people in my family."},
  {w:"hobby", ic:"bolt", q:"Your hobby?", a:"My hobby is ___."},
  {w:"free time", ic:"bolt", q:"Free time?", a:"In my free time, I ___."},
];

const schoolCore16 = [
  {w:"student", ic:"school", q:"Are you a student?", a:"Yes, I‚Äôm a student."},
  {w:"school", ic:"school", q:"Do you like your school?", a:"My school is ___."},
  {w:"class", ic:"group", q:"Your class?", a:"I‚Äôm in Class ___."},
  {w:"classroom", ic:"school", q:"Your classroom?", a:"My classroom is ___."},
  {w:"teacher", ic:"teacher", q:"Teacher like?", a:"My teacher is ___."},
  {w:"subject", ic:"book", q:"Subjects?", a:"I study English, maths and ___."},
  {w:"lesson", ic:"book", q:"Lessons?", a:"I have ___ lessons on ___."},
  {w:"timetable", ic:"book", q:"Timetable?", a:"My timetable is ___."},
  {w:"homework", ic:"book", q:"Homework?", a:"I do homework at home."},
  {w:"break", ic:"bolt", q:"Break time?", a:"At break time, I ___."},
  {w:"library", ic:"book", q:"Library?", a:"I go to the library to ___."},
  {w:"playground", ic:"bolt", q:"Playground?", a:"I play ___ in the playground."},
  {w:"exam", ic:"book", q:"Exams?", a:"We have exams sometimes."},
  {w:"club", ic:"bolt", q:"Club?", a:"I go to a club after school."},
  {w:"uniform", ic:"school", q:"Uniform?", a:"I wear a uniform."},
  {w:"classmates", ic:"group", q:"Classmates?", a:"I get along with my classmates."},
];

const chunks6 = [
  {w:"my favourite subject", ic:"book", q:"Make a sentence", a:"My favourite subject is ___ because ___."},
  {w:"after-school club", ic:"bolt", q:"Make a sentence", a:"I go to an after-school club."},
  {w:"from Monday to Friday", ic:"book", q:"Make a sentence", a:"I have lessons from Monday to Friday."},
  {w:"have lessons / have a break", ic:"bolt", q:"Make a sentence", a:"We have lessons and then we have a break."},
  {w:"do homework at home", ic:"book", q:"Make a sentence", a:"I do homework at home after school."},
  {w:"get along with my classmates", ic:"group", q:"Make a sentence", a:"I get along with my classmates because they are friendly."},
];

const frames12 = [
  "I‚Äôm a student at ___.",
  "I study at ___ School.",
  "My school is big/clean/friendly.",
  "I study English, maths and ___.",
  "My favourite subject is ___ because ___.",
  "I usually have ___ lessons on ___.",
  "My teacher is ___ and ___.",
  "After school, I often ___.",
  "I‚Äôm good at ___ / I‚Äôm not good at ___.",
  "I have lessons / I have a break.",
  "I do homework at home.",
  "I get along with my classmates."
];

const highs6 = [
  "My full name is ___, but you can call me ___.",
  "What I like most is ___.",
  "It helps me ___.",
  "I feel ___ when ___.",
  "I‚Äôm interested in ___.",
  "If I have time, I ___."
];

// Exam questions (6+6)
const examPersonal6 = [
  "What‚Äôs your name?",
  "How old are you?",
  "Where do you live?",
  "Who do you live with?",
  "Where are you from?",
  "What do you like doing in your free time?",
];
const examSchool6 = [
  "What school do you go to?",
  "What subjects do you study?",
  "What‚Äôs your favourite subject? Why?",
  "Do you like your school? Why?",
  "What‚Äôs your teacher like?",
  "What do you do after school?",
];

/* =========================
   3) Slide builder helpers
   ========================= */
function makeTileCard(item, tagText){
  const t = document.createElement('div');
  t.className = 'tile';
  t.innerHTML = `
    <div class="tag">${tagText}</div>
    <div class="front">
      <div class="w">
        ${svgIcon(item.ic)}
        <div>
          <div class="word">${item.w}</div>
          <div class="hint">Tap to reveal</div>
        </div>
      </div>
    </div>
    <div class="back">
      <div class="mini"><b>${item.q}</b></div>
      <div class="hint">${item.a}</div>
      <div class="hint" style="margin-top:6px;opacity:.9">+ one more sentence</div>
    </div>
  `;
  t.addEventListener('click', ()=>t.classList.toggle('on'));
  return t;
}

function makeSimpleList(items){
  const box = document.createElement('div');
  box.className = 'grid6';
  items.forEach(x=>box.appendChild(x));
  return box;
}

function slideShell({title, stage, rightMeta, one=false}){
  const s = document.createElement('section');
  s.className = 'slide';
  s.dataset.title = title;

  const header = document.createElement('div');
  header.className = 'header';
  header.innerHTML = `
    <div class="badge"><span class="dot"></span> ${stage}</div>
    <div class="meta">
      <span class="pill" data-count>1 / 1</span>
      ${rightMeta ? `<span class="pill">${rightMeta}</span>` : ``}
      <button class="blue" onclick="togglePicker(true)">Menu</button>
    </div>
  `;

  const wrap = document.createElement('div');
  wrap.className = 'wrap' + (one ? ' one' : '');

  s.appendChild(header);
  s.appendChild(wrap);
  return {s, wrap};
}

/* =========================
   4) Define slides (short, clean, teacher-friendly flow)
   Each slide has ONE micro-goal.
   ========================= */
const slideDefs = [
  // 1 Cover
  {
    title:"Welcome",
    stage:"T1 ¬∑ About Me & School",
    one:true,
    left: (root)=> {
      root.innerHTML = `
        <div class="card">
          <h1>About Me & School</h1>
          <div class="sub">KET Speaking ¬∑ 1-to-1</div>
          <div class="scene">${sceneSVG("cover")}</div>
          <div class="turn">
            <div class="tTitle">üé§ Your Turn</div>
            <ul>
              <li>Say: ‚ÄúHello! Nice to meet you.‚Äù</li>
              <li>Say: ‚ÄúI‚Äôm ready!‚Äù</li>
            </ul>
          </div>
        </div>
      `;
    }
  },

  // 2 Mission
  {
    title:"Mission",
    stage:"Mission",
    rightMeta:"Goal: 40‚Äì50s",
    left:(root)=>{
      root.innerHTML = `
        <div class="card">
          <h2>üéØ Today‚Äôs Goal</h2>
          <div class="big"><b>40‚Äì50 seconds</b> ¬∑ <b>6+ sentences</b> ¬∑ <b>because √ó2</b></div>
          <div class="turn">
            <div class="tTitle">üé§ Your Turn</div>
            <ul>
              <li>Repeat: ‚ÄúI will speak for 40 to 50 seconds.‚Äù</li>
              <li>Repeat: ‚ÄúI will use two because.‚Äù</li>
            </ul>
          </div>
        </div>
      `;
    },
    right:(root)=>{
      root.innerHTML = `
        <div class="card soft">
          <h2>Rule</h2>
          <div class="sub">Every answer = <b>2 sentences</b><br>(Answer + Detail)</div>
          <div class="scene">${sceneSVG("personal")}</div>
        </div>
      `;
    }
  },

  // 3 Warm-up (Imitate)
  {
    title:"Warm-up",
    stage:"Warm-up",
    left:(root)=>{
      root.innerHTML = `
        <div class="card">
          <h2>‚ö° Imitate (2 times)</h2>
          <div class="sub">Say it like the teacher, then change it.</div>
          <div class="scene">
            <div style="max-width:720px;width:100%">
              <div style="font-size:18px;line-height:1.7;color:var(--ink);background:rgba(77,150,255,.08);border:1px solid rgba(77,150,255,.18);padding:14px;border-radius:18px">
                My name is Alex. I‚Äôm 12 years old.<br>
                I study at Sunshine School because it‚Äôs friendly.
              </div>
              <div class="mini" style="margin-top:10px;color:var(--mut)">Tap nothing ‚Äî just speak üôÇ</div>
            </div>
          </div>
          <div class="turn">
            <div class="tTitle">üé§ Your Turn</div>
            <ul>
              <li>Round 1: copy (same words)</li>
              <li>Round 2: change (your info) + because</li>
            </ul>
          </div>
        </div>
      `;
    },
    right:(root)=>{
      root.innerHTML = `
        <div class="card soft">
          <h2>Pick 1 power word</h2>
          <div class="sub">Use it in a sentence.</div>
          <div class="btnRow" id="pwBtns"></div>
          <div class="turn">
            <div class="tTitle">üé§ Your Turn</div>
            <ul><li>Say: ‚ÄúMy school is ___ because ___.‚Äù</li></ul>
          </div>
        </div>
      `;
    },
    onMount: ()=>{
      const box = document.getElementById('pwBtns');
      if(!box) return;
      box.innerHTML = "";
      ["friendly","helpful","interesting","useful","comfortable","popular"].forEach((w,i)=>{
        const b = document.createElement('button');
        b.className = (i%2===0) ? 'blue' : 'pink';
        b.textContent = w;
        b.onclick = ()=> {
          [...box.children].forEach(x=>x.style.outline='none');
          b.style.outline = '3px solid rgba(77,150,255,.22)';
        };
        box.appendChild(b);
      });
    }
  },

  // 4‚Äì5 Personal vocab (6 per slide)
  {
    title:"Personal Words 1",
    stage:"Personal ¬∑ Core",
    rightMeta:"6 words",
    left:(root)=>{
      root.innerHTML = `
        <div class="card">
          <h2>Personal Words</h2>
          <div class="sub">Tap a card ‚Üí speak 2 sentences.</div>
          <div id="pv1" class="grid6"></div>
          <div class="turn">
            <div class="tTitle">üé§ Your Turn</div>
            <ul>
              <li>Pick any 3 cards ‚Üí 3 mini answers</li>
              <li>Use because once</li>
            </ul>
          </div>
        </div>
      `;
    },
    right:(root)=>{
      root.innerHTML = `
        <div class="card soft">
          <h2>Picture prompt</h2>
          <div class="scene">${sceneSVG("personal")}</div>
          <div class="turn">
            <div class="tTitle">üé§ Your Turn</div>
            <ul><li>Say 2 sentences: name + city</li></ul>
          </div>
        </div>
      `;
    },
    onMount: ()=>{
      const host = document.getElementById('pv1');
      host.innerHTML = "";
      personalCore12.slice(0,6).forEach(x=>host.appendChild(makeTileCard(x,"Core")));
    }
  },
  {
    title:"Personal Words 2",
    stage:"Personal ¬∑ Core",
    rightMeta:"6 words",
    left:(root)=>{
      root.innerHTML = `
        <div class="card">
          <h2>Personal Words</h2>
          <div class="sub">Tap a card ‚Üí speak 2 sentences.</div>
          <div id="pv2" class="grid6"></div>
          <div class="turn">
            <div class="tTitle">üé§ Your Turn</div>
            <ul>
              <li>Answer: ‚ÄúWhere do you live?‚Äù (2 sentences)</li>
              <li>Answer: ‚ÄúWhat‚Äôs your hobby?‚Äù (2 sentences)</li>
            </ul>
          </div>
        </div>
      `;
    },
    right:(root)=>{
      root.innerHTML = `
        <div class="card soft">
          <h2>Quick fix</h2>
          <div class="sub"><b>live in</b> (place) ¬∑ <b>live with</b> (people)</div>
          <div class="scene">
            <div style="max-width:720px;width:100%">
              <div class="mini" style="margin-bottom:10px">Say both:</div>
              <div style="display:flex;gap:10px;flex-wrap:wrap">
                <div style="flex:1;min-width:220px;background:rgba(77,150,255,.10);border:1px solid rgba(77,150,255,.20);padding:12px;border-radius:18px">
                  I live in ___.
                </div>
                <div style="flex:1;min-width:220px;background:rgba(34,197,94,.10);border:1px solid rgba(34,197,94,.20);padding:12px;border-radius:18px">
                  I live with ___.
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
    },
    onMount: ()=>{
      const host = document.getElementById('pv2');
      host.innerHTML = "";
      personalCore12.slice(6,12).forEach(x=>host.appendChild(makeTileCard(x,"Core")));
    }
  },

  // 6‚Äì8 School vocab (split into 3 smaller slides: 6 / 5 / 5)
  {
    title:"School Words 1",
    stage:"School ¬∑ Core",
    rightMeta:"6 words",
    left:(root)=>{
      root.innerHTML = `
        <div class="card">
          <h2>School Words</h2>
          <div class="sub">Tap a card ‚Üí speak 2 sentences.</div>
          <div id="sv1" class="grid6"></div>
          <div class="turn">
            <div class="tTitle">üé§ Your Turn</div>
            <ul>
              <li>Say 3 sentences about your school</li>
              <li>Add 1 power word</li>
            </ul>
          </div>
        </div>
      `;
    },
    right:(root)=>{
      root.innerHTML = `
        <div class="card soft">
          <h2>Picture prompt</h2>
          <div class="scene">${sceneSVG("school")}</div>
        </div>
      `;
    },
    onMount: ()=>{
      const host = document.getElementById('sv1');
      host.innerHTML = "";
      schoolCore16.slice(0,6).forEach(x=>host.appendChild(makeTileCard(x,"Core")));
    }
  },
  {
    title:"School Words 2",
    stage:"School ¬∑ Core",
    rightMeta:"5 words",
    left:(root)=>{
      root.innerHTML = `
        <div class="card">
          <h2>School Words</h2>
          <div class="sub">Tap a card ‚Üí speak 2 sentences.</div>
          <div id="sv2" class="grid6"></div>
          <div class="turn">
            <div class="tTitle">üé§ Your Turn</div>
            <ul>
              <li>Answer: ‚ÄúWhat subjects do you study?‚Äù</li>
              <li>Use ‚Äúand‚Äù</li>
            </ul>
          </div>
        </div>
      `;
    },
    right:(root)=>{
      root.innerHTML = `
        <div class="card soft">
          <h2>Mini speaking rule</h2>
          <div class="sub">Answer + Detail</div>
          <div class="scene">
            <div style="max-width:720px;width:100%">
              <div style="background:rgba(251,191,36,.14);border:1px solid rgba(251,191,36,.22);padding:14px;border-radius:18px;font-size:18px;line-height:1.7">
                I study English, maths and science.<br>
                English is my favourite because it‚Äôs useful.
              </div>
            </div>
          </div>
        </div>
      `;
    },
    onMount: ()=>{
      const host = document.getElementById('sv2');
      host.innerHTML = "";
      schoolCore16.slice(6,11).forEach(x=>host.appendChild(makeTileCard(x,"Core")));
    }
  },
  {
    title:"School Words 3",
    stage:"School ¬∑ Core",
    rightMeta:"5 words",
    left:(root)=>{
      root.innerHTML = `
        <div class="card">
          <h2>School Words</h2>
          <div class="sub">Tap a card ‚Üí speak 2 sentences.</div>
          <div id="sv3" class="grid6"></div>
          <div class="turn">
            <div class="tTitle">üé§ Your Turn</div>
            <ul>
              <li>Say 2 sentences about after school</li>
              <li>Use: club / homework</li>
            </ul>
          </div>
        </div>
      `;
    },
    right:(root)=>{
      root.innerHTML = `
        <div class="card soft">
          <h2>Quick challenge</h2>
          <div class="sub">Use 2 power words:</div>
          <div class="btnRow" id="pwBtns2"></div>
        </div>
      `;
    },
    onMount: ()=>{
      const host = document.getElementById('sv3');
      host.innerHTML = "";
      schoolCore16.slice(11,16).forEach(x=>host.appendChild(makeTileCard(x,"Core")));
      const box = document.getElementById('pwBtns2');
      box.innerHTML = "";
      ["friendly","helpful","interesting","useful","comfortable"].forEach((w,i)=>{
        const b = document.createElement('button');
        b.className = (i%2===0) ? 'blue' : 'pink';
        b.textContent = w;
        box.appendChild(b);
      });
    }
  },

  // 9 Power words (10 words, split 5+5)
  {
    title:"Power Words 1",
    stage:"Power Words",
    rightMeta:"5 words",
    left:(root)=>{
      root.innerHTML = `
        <div class="card">
          <h2>${svgIcon("bolt")} Power Words</h2>
          <div class="sub">Say 1 sentence for each word.</div>
          <div class="btnRow" id="pwA"></div>
          <div class="turn">
            <div class="tTitle">üé§ Your Turn</div>
            <ul><li>Pick 2 words ‚Üí 2 sentences</li></ul>
          </div>
        </div>
      `;
    },
    right:(root)=>{
      root.innerHTML = `
        <div class="card soft">
          <h2>Sentence starter</h2>
          <div class="scene">
            <div style="max-width:720px;width:100%">
              <div style="background:rgba(77,150,255,.10);border:1px solid rgba(77,150,255,.20);padding:14px;border-radius:18px;font-size:18px;line-height:1.7">
                My school is ___ and ___.<br>
                My teacher is ___ and ___.
              </div>
            </div>
          </div>
        </div>
      `;
    },
    onMount: ()=>{
      const box = document.getElementById('pwA');
      box.innerHTML = "";
      powerWords.slice(0,5).forEach((w,i)=>{
        const b = document.createElement('button');
        b.className = (i%2===0) ? 'blue' : 'pink';
        b.textContent = w;
        box.appendChild(b);
      });
    }
  },
  {
    title:"Power Words 2",
    stage:"Power Words",
    rightMeta:"5 words",
    left:(root)=>{
      root.innerHTML = `
        <div class="card">
          <h2>${svgIcon("bolt")} Power Words</h2>
          <div class="sub">Say 1 sentence for each word.</div>
          <div class="btnRow" id="pwB"></div>
          <div class="turn">
            <div class="tTitle">üé§ Your Turn</div>
            <ul>
              <li>Make 1 ‚Äúbecause‚Äù sentence using a power word</li>
            </ul>
          </div>
        </div>
      `;
    },
    right:(root)=>{
      root.innerHTML = `
        <div class="card soft">
          <h2>Because ideas</h2>
          <div class="scene">
            <div style="max-width:720px;width:100%">
              <div class="mini">Use one:</div>
              <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:10px">
                <div style="flex:1;min-width:220px;background:rgba(34,197,94,.10);border:1px solid rgba(34,197,94,.20);padding:12px;border-radius:18px">
                  because it‚Äôs useful
                </div>
                <div style="flex:1;min-width:220px;background:rgba(251,113,133,.10);border:1px solid rgba(251,113,133,.20);padding:12px;border-radius:18px">
                  because it‚Äôs interesting
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
    },
    onMount: ()=>{
      const box = document.getElementById('pwB');
      box.innerHTML = "";
      powerWords.slice(5,10).forEach((w,i)=>{
        const b = document.createElement('button');
        b.className = (i%2===0) ? 'blue' : 'pink';
        b.textContent = w;
        box.appendChild(b);
      });
    }
  },

  // 11 Chunks (6, split 3+3)
  {
    title:"Chunks 1",
    stage:"Chunks",
    rightMeta:"3 chunks",
    left:(root)=>{
      root.innerHTML = `
        <div class="card">
          <h2>üß© Chunks</h2>
          <div class="sub">Tap a chunk ‚Üí speak 2 sentences.</div>
          <div id="ch1" class="grid6"></div>
          <div class="turn">
            <div class="tTitle">üé§ Your Turn</div>
            <ul><li>Pick 2 chunks ‚Üí 4 sentences</li></ul>
          </div>
        </div>
      `;
    },
    right:(root)=>{
      root.innerHTML = `
        <div class="card soft">
          <h2>Quick connect</h2>
          <div class="sub">Use ‚Äúand / also / then‚Äù.</div>
          <div class="scene">${sceneSVG("school")}</div>
        </div>
      `;
    },
    onMount: ()=>{
      const host = document.getElementById('ch1');
      host.innerHTML = "";
      chunks6.slice(0,3).forEach(x=>host.appendChild(makeTileCard(x,"Chunk")));
    }
  },
  {
    title:"Chunks 2",
    stage:"Chunks",
    rightMeta:"3 chunks",
    left:(root)=>{
      root.innerHTML = `
        <div class="card">
          <h2>üß© Chunks</h2>
          <div class="sub">Tap a chunk ‚Üí speak 2 sentences.</div>
          <div id="ch2" class="grid6"></div>
          <div class="turn">
            <div class="tTitle">üé§ Your Turn</div>
            <ul><li>Say 2 sentences using ‚Äúget along‚Äù</li></ul>
          </div>
        </div>
      `;
    },
    right:(root)=>{
      root.innerHTML = `
        <div class="card soft">
          <h2>Random chunk</h2>
          <div class="sub">Click ‚Üí speak 2 sentences.</div>
          <div class="btnRow">
            <button class="blue" onclick="pickChunk()">Pick</button>
            <button onclick="pickChunk()">Again</button>
          </div>
          <div id="chunkBox" class="scene" style="min-height:170px"></div>
        </div>
      `;
    },
    onMount: ()=>{
      const host = document.getElementById('ch2');
      host.innerHTML = "";
      chunks6.slice(3,6).forEach(x=>host.appendChild(makeTileCard(x,"Chunk")));
      pickChunk();
    }
  },

  // 13‚Äì14 Frames (12 split 6+6)
  {
    title:"Key Sentences 1",
    stage:"Key Sentences",
    rightMeta:"6 frames",
    left:(root)=>{
      root.innerHTML = `
        <div class="card">
          <h2>üß± Key Sentences</h2>
          <div class="sub">Tap ‚Üí reveal ‚Üí say it.</div>
          <div id="fr1" class="grid6"></div>
          <div class="turn">
            <div class="tTitle">üé§ Your Turn</div>
            <ul><li>Choose 3 frames ‚Üí speak 3 sentences</li></ul>
          </div>
        </div>
      `;
    },
    right:(root)=>{
      root.innerHTML = `
        <div class="card soft">
          <h2>Because √ó2</h2>
          <div class="scene">
            <div style="max-width:720px;width:100%">
              <div style="background:rgba(251,191,36,.14);border:1px solid rgba(251,191,36,.22);padding:14px;border-radius:18px;font-size:18px;line-height:1.7">
                My favourite subject is ___ because ___.<br>
                And because ___.
              </div>
            </div>
          </div>
        </div>
      `;
    },
    onMount: ()=>{
      const host = document.getElementById('fr1');
      host.innerHTML = "";
      frames12.slice(0,6).forEach(t=>{
        host.appendChild(makeTileCard({w:t, ic:"book", q:"Say it", a:t},"Frame"));
      });
    }
  },
  {
    title:"Key Sentences 2",
    stage:"Key Sentences",
    rightMeta:"6 frames",
    left:(root)=>{
      root.innerHTML = `
        <div class="card">
          <h2>üß± Key Sentences</h2>
          <div class="sub">Tap ‚Üí reveal ‚Üí say it.</div>
          <div id="fr2" class="grid6"></div>
          <div class="turn">
            <div class="tTitle">üé§ Your Turn</div>
            <ul>
              <li>Make 5 sentences (school only)</li>
              <li>Add 1 power word</li>
            </ul>
          </div>
        </div>
      `;
    },
    right:(root)=>{
      root.innerHTML = `
        <div class="card soft">
          <h2>Mini story</h2>
          <div class="sub">Try: teacher ‚Üí subject ‚Üí after school</div>
          <div class="scene">${sceneSVG("school")}</div>
        </div>
      `;
    },
    onMount: ()=>{
      const host = document.getElementById('fr2');
      host.innerHTML = "";
      frames12.slice(6,12).forEach(t=>{
        host.appendChild(makeTileCard({w:t, ic:"book", q:"Say it", a:t},"Frame"));
      });
    }
  },

  // 15‚Äì16 High-score lines (6 split 3+3)
  {
    title:"High-score 1",
    stage:"High-score Lines",
    rightMeta:"3 lines",
    left:(root)=>{
      root.innerHTML = `
        <div class="card">
          <h2>‚≠ê High-score Lines</h2>
          <div class="sub">Use 1 line ‚Üí add 1 detail sentence.</div>
          <div id="hs1" class="grid6"></div>
          <div class="turn">
            <div class="tTitle">üé§ Your Turn</div>
            <ul><li>Use 2 lines ‚Üí 4 sentences</li></ul>
          </div>
        </div>
      `;
    },
    right:(root)=>{
      root.innerHTML = `
        <div class="card soft">
          <h2>Upgrade tip</h2>
          <div class="sub">Add: ‚ÄúIt helps me ‚Ä¶‚Äù</div>
          <div class="scene">
            <div style="max-width:720px;width:100%">
              <div style="background:rgba(34,197,94,.10);border:1px solid rgba(34,197,94,.20);padding:14px;border-radius:18px;font-size:18px;line-height:1.7">
                What I like most is English.<br>
                It helps me speak better.
              </div>
            </div>
          </div>
        </div>
      `;
    },
    onMount: ()=>{
      const host = document.getElementById('hs1');
      host.innerHTML = "";
      highs6.slice(0,3).forEach(t=>{
        host.appendChild(makeTileCard({w:t, ic:"tag", q:"Say it", a:t},"High"));
      });
    }
  },
  {
    title:"High-score 2",
    stage:"High-score Lines",
    rightMeta:"3 lines",
    left:(root)=>{
      root.innerHTML = `
        <div class="card">
          <h2>‚≠ê High-score Lines</h2>
          <div class="sub">Use 1 line ‚Üí add 1 detail sentence.</div>
          <div id="hs2" class="grid6"></div>
          <div class="turn">
            <div class="tTitle">üé§ Your Turn</div>
            <ul><li>Say 3 sentences using 2 lines + because</li></ul>
          </div>
        </div>
      `;
    },
    right:(root)=>{
      root.innerHTML = `
        <div class="card soft">
          <h2>Feeling</h2>
          <div class="scene">
            <div style="max-width:720px;width:100%">
              <div style="background:rgba(251,113,133,.10);border:1px solid rgba(251,113,133,.20);padding:14px;border-radius:18px;font-size:18px;line-height:1.7">
                I feel proud when I get good marks.
              </div>
            </div>
          </div>
        </div>
      `;
    },
    onMount: ()=>{
      const host = document.getElementById('hs2');
      host.innerHTML = "";
      highs6.slice(3,6).forEach(t=>{
        host.appendChild(makeTileCard({w:t, ic:"bolt", q:"Say it", a:t},"High"));
      });
    }
  },

  // 17 Structure map (one slide, simple)
  {
    title:"7-step Map",
    stage:"Structure",
    rightMeta:"Talk order",
    left:(root)=>{
      root.innerHTML = `
        <div class="card">
          <h2>üó∫Ô∏è 7-step Map</h2>
          <div class="scene" style="min-height:220px">
            <div style="max-width:760px;width:100%;display:grid;gap:10px">
              ${[
                "1) Name + Age",
                "2) Live (in / with / from)",
                "3) School",
                "4) Favourite subject (because √ó2)",
                "5) After school",
                "6) Good at / Interested in",
                "7) Feeling"
              ].map(x=>`<div style="background:rgba(77,150,255,.08);border:1px solid rgba(77,150,255,.16);padding:12px;border-radius:18px;font-size:16px">${x}</div>`).join("")}
            </div>
          </div>
          <div class="turn">
            <div class="tTitle">üé§ Your Turn</div>
            <ul>
              <li>Say 1 sentence for step 1 ‚Üí step 7</li>
              <li>Step 4: because √ó2</li>
            </ul>
          </div>
        </div>
      `;
    },
    right:(root)=>{
      root.innerHTML = `
        <div class="card soft">
          <h2>Quick start</h2>
          <div class="sub">Say step 1 now:</div>
          <div class="scene" style="min-height:180px">
            <div style="max-width:720px;width:100%">
              <div style="background:rgba(255,255,255,.85);border:1px solid rgba(30,42,68,.10);padding:14px;border-radius:18px;font-size:18px;line-height:1.7">
                My name is ___. I‚Äôm ___ years old.
              </div>
            </div>
          </div>
        </div>
      `;
    }
  },

  // 18‚Äì19 Exam Q practice (3 questions per slide)
  {
    title:"Exam Q ¬∑ Personal 1",
    stage:"Exam Practice",
    rightMeta:"Personal",
    left:(root)=>{
      root.innerHTML = `
        <div class="card">
          <h2>‚ùì Personal Questions</h2>
          <div class="sub">Rule: 2 sentences each.</div>
          <div id="qP1" class="scene" style="min-height:220px"></div>
          <div class="turn">
            <div class="tTitle">üé§ Your Turn</div>
            <ul>
              <li>Answer all 3 (no stopping)</li>
              <li>Use because once</li>
            </ul>
          </div>
        </div>
      `;
    },
    right:(root)=>{
      root.innerHTML = `
        <div class="card soft">
          <h2>Magic 2nd sentence</h2>
          <div class="scene" style="min-height:200px">
            <div style="max-width:720px;width:100%">
              <div style="background:rgba(77,150,255,.10);border:1px solid rgba(77,150,255,.20);padding:14px;border-radius:18px;font-size:18px;line-height:1.7">
                I like it because ___.<br>
                It helps me ___.<br>
                I feel ___ when ___.
              </div>
            </div>
          </div>
        </div>
      `;
    },
    onMount: ()=>{
      const host = document.getElementById('qP1');
      host.innerHTML = `
        <div style="max-width:780px;width:100%;display:grid;gap:10px">
          ${examPersonal6.slice(0,3).map(q=>`
            <div style="background:rgba(255,255,255,.86);border:1px solid rgba(30,42,68,.10);padding:14px;border-radius:18px;font-size:18px">
              ${q}
            </div>`).join("")}
        </div>
      `;
    }
  },
  {
    title:"Exam Q ¬∑ Personal 2",
    stage:"Exam Practice",
    rightMeta:"Personal",
    left:(root)=>{
      root.innerHTML = `
        <div class="card">
          <h2>‚ùì Personal Questions</h2>
          <div class="sub">Rule: 2 sentences each.</div>
          <div id="qP2" class="scene" style="min-height:220px"></div>
          <div class="turn">
            <div class="tTitle">üé§ Your Turn</div>
            <ul>
              <li>Answer all 3</li>
              <li>Use because once</li>
            </ul>
          </div>
        </div>
      `;
    },
    right:(root)=>{
      root.innerHTML = `
        <div class="card soft">
          <h2>Fast game</h2>
          <div class="sub">Click ‚Üí new question</div>
          <div class="btnRow">
            <button class="blue" onclick="spinQ('spinP')">Pick</button>
            <button onclick="spinQ('spinP')">Again</button>
          </div>
          <div id="spinP" class="scene" style="min-height:190px"></div>
        </div>
      `;
    },
    onMount: ()=>{
      const host = document.getElementById('qP2');
      host.innerHTML = `
        <div style="max-width:780px;width:100%;display:grid;gap:10px">
          ${examPersonal6.slice(3,6).map(q=>`
            <div style="background:rgba(255,255,255,.86);border:1px solid rgba(30,42,68,.10);padding:14px;border-radius:18px;font-size:18px">
              ${q}
            </div>`).join("")}
        </div>
      `;
      spinQ('spinP', examPersonal6);
    }
  },

  // 20‚Äì21 Exam Q School (3+3)
  {
    title:"Exam Q ¬∑ School 1",
    stage:"Exam Practice",
    rightMeta:"School",
    left:(root)=>{
      root.innerHTML = `
        <div class="card">
          <h2>‚ùì School Questions</h2>
          <div class="sub">Rule: 2 sentences each.</div>
          <div id="qS1" class="scene" style="min-height:220px"></div>
          <div class="turn">
            <div class="tTitle">üé§ Your Turn</div>
            <ul>
              <li>Answer all 3</li>
              <li>Q3: because √ó2</li>
            </ul>
          </div>
        </div>
      `;
    },
    right:(root)=>{
      root.innerHTML = `
        <div class="card soft">
          <h2>Because √ó2 helper</h2>
          <div class="scene" style="min-height:200px">
            <div style="max-width:720px;width:100%">
              <div style="background:rgba(251,191,36,.14);border:1px solid rgba(251,191,36,.22);padding:14px;border-radius:18px;font-size:18px;line-height:1.7">
                because it‚Äôs useful<br>
                because it‚Äôs interesting<br>
                because my teacher is helpful
              </div>
            </div>
          </div>
        </div>
      `;
    },
    onMount: ()=>{
      const host = document.getElementById('qS1');
      host.innerHTML = `
        <div style="max-width:780px;width:100%;display:grid;gap:10px">
          ${examSchool6.slice(0,3).map(q=>`
            <div style="background:rgba(255,255,255,.86);border:1px solid rgba(30,42,68,.10);padding:14px;border-radius:18px;font-size:18px">
              ${q}
            </div>`).join("")}
        </div>
      `;
    }
  },
  {
    title:"Exam Q ¬∑ School 2",
    stage:"Exam Practice",
    rightMeta:"School",
    left:(root)=>{
      root.innerHTML = `
        <div class="card">
          <h2>‚ùì School Questions</h2>
          <div class="sub">Rule: 2 sentences each.</div>
          <div id="qS2" class="scene" style="min-height:220px"></div>
          <div class="turn">
            <div class="tTitle">üé§ Your Turn</div>
            <ul>
              <li>Answer all 3</li>
              <li>Use 2 power words</li>
            </ul>
          </div>
        </div>
      `;
    },
    right:(root)=>{
      root.innerHTML = `
        <div class="card soft">
          <h2>Fast game</h2>
          <div class="sub">Click ‚Üí new question</div>
          <div class="btnRow">
            <button class="blue" onclick="spinQ('spinS')">Pick</button>
            <button onclick="spinQ('spinS')">Again</button>
          </div>
          <div id="spinS" class="scene" style="min-height:190px"></div>
        </div>
      `;
    },
    onMount: ()=>{
      const host = document.getElementById('qS2');
      host.innerHTML = `
        <div style="max-width:780px;width:100%;display:grid;gap:10px">
          ${examSchool6.slice(3,6).map(q=>`
            <div style="background:rgba(255,255,255,.86);border:1px solid rgba(30,42,68,.10);padding:14px;border-radius:18px;font-size:18px">
              ${q}
            </div>`).join("")}
        </div>
      `;
      spinQ('spinS', examSchool6);
    }
  },

  // 22 Picture spinner (highly teacher-friendly: repeat many rounds)
  {
    title:"Picture Spinner",
    stage:"Practice",
    rightMeta:"2 sentences each",
    left:(root)=>{
      root.innerHTML = `
        <div class="card">
          <h2>üé° Picture Spinner</h2>
          <div class="sub">Rule: <b>2 sentences</b> every time.</div>
          <div class="btnRow">
            <button class="primary" onclick="spinPic()">Spin</button>
            <button onclick="spinPic()">Again</button>
          </div>
          <div id="picLabel" class="mini" style="margin-top:10px">Click Spin.</div>
          <div id="picStage" class="scene" style="min-height:260px"></div>
          <div class="turn">
            <div class="tTitle">üé§ Your Turn</div>
            <ul>
              <li>Sentence 1: ‚ÄúThis is the ___.‚Äù / ‚ÄúI go to the ___.‚Äù</li>
              <li>Sentence 2: ‚ÄúI like it because ___.‚Äù</li>
            </ul>
          </div>
        </div>
      `;
    },
    right:(root)=>{
      root.innerHTML = `
        <div class="card soft">
          <h2>Bonus</h2>
          <div class="sub">Add 1 power word.</div>
          <div class="btnRow" id="bonusPW"></div>
          <div class="scene" style="min-height:190px">${sceneSVG("school")}</div>
        </div>
      `;
    },
    onMount: ()=>{
      const box = document.getElementById('bonusPW');
      box.innerHTML = "";
      ["friendly","interesting","useful","comfortable","popular"].forEach((w,i)=>{
        const b = document.createElement('button');
        b.className = (i%2===0) ? 'blue' : 'pink';
        b.textContent = w;
        box.appendChild(b);
      });
      spinPic();
    }
  },

  // 23 Drag & build (kept, but simpler UI)
  {
    title:"Build a Sentence",
    stage:"Practice",
    rightMeta:"Tap tiles",
    left:(root)=>{
      root.innerHTML = `
        <div class="card">
          <h2>üß© Build a sentence</h2>
          <div class="sub">Tap tiles ‚Üí read it ‚Üí add 1 detail sentence.</div>

          <div class="scene" style="min-height:170px">
            <div style="max-width:820px;width:100%">
              <div class="mini"><b>Sentence</b> (tap a word to remove)</div>
              <div id="buildLine" style="display:flex;flex-wrap:wrap;gap:8px;margin-top:10px;min-height:52px;
                padding:12px;border-radius:18px;border:1px dashed rgba(30,42,68,.18);background:rgba(255,255,255,.86)"></div>

              <div class="btnRow">
                <button class="blue" onclick="buildRandom()">Random</button>
                <button onclick="buildUndo()">Undo</button>
                <button class="pink" onclick="buildClear()">Clear</button>
              </div>
            </div>
          </div>

          <div class="turn">
            <div class="tTitle">üé§ Your Turn</div>
            <ul>
              <li>Read your sentence</li>
              <li>Add 1 detail sentence</li>
              <li>Try: because √ó2</li>
            </ul>
          </div>
        </div>
      `;
    },
    right:(root)=>{
      root.innerHTML = `
        <div class="card soft">
          <h2>Tiles</h2>
          <div class="mini">Tap to add</div>
          <div id="tiles" style="display:flex;flex-wrap:wrap;gap:10px;margin-top:10px"></div>
        </div>
      `;
    },
    onMount: ()=>{
      mountBuildTiles();
      buildClear();
    }
  },

  // 24 Role-play (clean prompt)
  {
    title:"Role-play",
    stage:"Practice",
    rightMeta:"New classmate",
    left:(root)=>{
      root.innerHTML = `
        <div class="card">
          <h2>üé≠ Role-play</h2>
          <div class="sub">Teacher: ‚ÄúI‚Äôm new here. Tell me about you and your school!‚Äù</div>
          <div class="scene" style="min-height:220px">
            <div style="max-width:760px;width:100%">
              <div style="background:rgba(255,255,255,.86);border:1px solid rgba(30,42,68,.10);padding:14px;border-radius:18px;font-size:18px;line-height:1.7">
                Start with:<br>
                ‚ÄúHi! My name is ___. I‚Äôm ___ years old.‚Äù
              </div>
            </div>
          </div>
          <div class="turn">
            <div class="tTitle">üé§ Your Turn</div>
            <ul>
              <li>Speak 30‚Äì40 seconds</li>
              <li>Use: power √ó2 + chunk √ó1 + because √ó2</li>
            </ul>
          </div>
        </div>
      `;
    },
    right:(root)=>{
      root.innerHTML = `
        <div class="card soft">
          <h2>Mini checklist</h2>
          <div class="scene" style="min-height:220px">
            <div style="max-width:720px;width:100%;display:grid;gap:10px">
              ${[
                "‚úÖ 6+ sentences",
                "‚úÖ because √ó2",
                "‚úÖ power words √ó2",
                "‚úÖ chunk √ó1"
              ].map(x=>`<div style="background:rgba(77,150,255,.08);border:1px solid rgba(77,150,255,.16);padding:12px;border-radius:18px;font-size:16px">${x}</div>`).join("")}
            </div>
          </div>
        </div>
      `;
    }
  },

  // 25 Timer (single slide with selectable duration)
  {
    title:"Timer",
    stage:"Final Output",
    rightMeta:"40‚Äì50s",
    left:(root)=>{
      root.innerHTML = `
        <div class="card">
          <h2>‚è≥ Timer</h2>
          <div class="sub">Choose 40 or 50. Speak without stopping.</div>

          <div class="timerWrap">
            <div class="ring" id="ring" style="--deg:0deg">
              <div class="timeBox">
                <p class="num" id="tNum">40</p>
                <p class="lab">seconds</p>
              </div>
            </div>
            <div>
              <div class="btnRow">
                <button class="primary" onclick="startTimer(40)">Start 40</button>
                <button class="blue" onclick="startTimer(50)">Start 50</button>
                <button onclick="pauseTimer()">Pause</button>
                <button class="pink" onclick="resetTimer()">Reset</button>
              </div>
              <div class="turn">
                <div class="tTitle">üé§ Your Turn</div>
                <ul>
                  <li>6+ sentences</li>
                  <li>because √ó2</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      `;
    },
    right:(root)=>{
      root.innerHTML = `
        <div class="card soft">
          <h2>Rescue words</h2>
          <div class="scene" style="min-height:220px">
            <div style="max-width:720px;width:100%">
              <div style="background:rgba(77,150,255,.10);border:1px solid rgba(77,150,255,.20);padding:14px;border-radius:18px;font-size:18px;line-height:1.7">
                Let me think‚Ä¶<br>
                Also,‚Ä¶ / And‚Ä¶ / Then‚Ä¶<br>
                because‚Ä¶
              </div>
            </div>
          </div>
        </div>
      `;
    }
  },

  // 26 Fix it (short, 3 items only)
  {
    title:"Fix it",
    stage:"Accuracy",
    rightMeta:"Say the correct sentence",
    left:(root)=>{
      root.innerHTML = `
        <div class="card">
          <h2>üõ†Ô∏è Fix it</h2>
          <div class="sub">Tap ‚Üí say the correct sentence.</div>
          <div id="fixBox" class="grid6"></div>
          <div class="turn">
            <div class="tTitle">üé§ Your Turn</div>
            <ul>
              <li>Fix 2 cards</li>
              <li>Add 1 detail sentence</li>
            </ul>
          </div>
        </div>
      `;
    },
    right:(root)=>{
      root.innerHTML = `
        <div class="card soft">
          <h2>Upgrade</h2>
          <div class="sub">Add 2 power words:</div>
          <div class="scene" style="min-height:220px">
            <div style="max-width:720px;width:100%">
              <div style="background:rgba(34,197,94,.10);border:1px solid rgba(34,197,94,.20);padding:14px;border-radius:18px;font-size:18px;line-height:1.7">
                My school is ___ and ___.<br>
                My teacher is ___ and ___.
              </div>
            </div>
          </div>
        </div>
      `;
    },
    onMount: ()=>{
      const wrong = [
        {w:"I live with Beijing.", ic:"home", q:"Fix it", a:"I live in Beijing. / I live with my parents."},
        {w:"I study in Sunshine School.", ic:"school", q:"Fix it", a:"I study at Sunshine School."},
        {w:"My favourite subject is English because useful.", ic:"book", q:"Fix it", a:"‚Ä¶because it‚Äôs useful."},
      ];
      const host = document.getElementById('fixBox');
      host.innerHTML = "";
      wrong.forEach(x=>host.appendChild(makeTileCard(x,"Fix")));
    }
  },

  // 27 End
  {
    title:"Bye",
    stage:"End",
    one:true,
    left:(root)=>{
      root.innerHTML = `
        <div class="card">
          <h1>üéâ Great job!</h1>
          <div class="sub">See you next time!</div>
          <div class="scene">${sceneSVG("cover")}</div>
          <div class="turn">
            <div class="tTitle">üé§ Your Turn</div>
            <ul><li>Say: ‚ÄúThank you! Bye!‚Äù</li></ul>
          </div>
        </div>
      `;
    }
  }
];

/* =========================
   5) Render slides + nav
   ========================= */
const deck = document.getElementById('deck');

const slides = [];
slideDefs.forEach(def=>{
  const {s, wrap} = slideShell({
    title: def.title,
    stage: def.stage,
    rightMeta: def.rightMeta,
    one: !!def.one
  });

  // build layout
  if(def.one){
    const left = document.createElement('div');
    left.className = 'slot';
    wrap.appendChild(left);
    def.left(left);
  } else {
    const left = document.createElement('div');
    const right = document.createElement('div');
    left.className = 'slot';
    right.className = 'slot';
    wrap.appendChild(left);
    wrap.appendChild(right);
    def.left(left);
    if(def.right) def.right(right);
  }

  deck.appendChild(s);
  slides.push({el:s, onMount:def.onMount || null, title:def.title});
});

// Bottom nav
const nav = document.createElement('div');
nav.id = "nav";
nav.innerHTML = `
  <button class="navBtn secondary" id="prev">‚¨Ö Prev</button>
  <div class="center">
    <span id="navTitle">Welcome</span>
    <div class="progress" aria-label="progress"><div class="bar" id="bar"></div></div>
    <span id="count">1 / ${slides.length}</span>
  </div>
  <button class="navBtn" id="next">Next ‚û°</button>
`;
deck.appendChild(nav);

let idx = 0;

function show(i){
  idx = Math.max(0, Math.min(slides.length-1, i));
  slides.forEach((s,k)=>s.el.classList.toggle('active', k===idx));

  // update header counter on slide
  const c = slides[idx].el.querySelector('[data-count]');
  if(c) c.textContent = `${idx+1} / ${slides.length}`;

  // update nav
  document.getElementById('navTitle').textContent = slides[idx].title;
  document.getElementById('count').textContent = `${idx+1} / ${slides.length}`;
  document.getElementById('prev').disabled = idx===0;
  document.getElementById('next').disabled = idx===slides.length-1;

  const pct = ((idx+1)/slides.length)*100;
  document.getElementById('bar').style.width = pct + '%';

  // run slide hook
  if(slides[idx].onMount) slides[idx].onMount();
}

document.getElementById('prev').onclick = ()=>show(idx-1);
document.getElementById('next').onclick = ()=>show(idx+1);

window.addEventListener('keydown', (e)=>{
  const k = e.key.toLowerCase();
  if(k==='arrowright' || k===' ' || k==='d') show(idx+1);
  if(k==='arrowleft' || k==='a') show(idx-1);
  if(k==='m') togglePicker(true);
  if(k==='escape') togglePicker(false);
});

// swipe
let sx=null;
window.addEventListener('touchstart', e=>sx=e.changedTouches[0].clientX, {passive:true});
window.addEventListener('touchend', e=>{
  if(sx===null) return;
  const dx = e.changedTouches[0].clientX - sx;
  if(dx < -50) show(idx+1);
  if(dx > 50) show(idx-1);
  sx=null;
},{passive:true});

show(0);

/* =========================
   6) Picker
   ========================= */
const picker = document.getElementById('picker');
const pickerList = document.getElementById('pickerList');

slides.forEach((s,i)=>{
  const b = document.createElement('div');
  b.className = 'jump';
  b.innerHTML = `<b>${i+1}. ${s.title}</b><small>${slideDefs[i].stage}</small>`;
  b.onclick = ()=>{ show(i); togglePicker(false); };
  pickerList.appendChild(b);
});

window.togglePicker = function(on){
  picker.classList.toggle('on', !!on);
  picker.setAttribute('aria-hidden', on ? 'false' : 'true');
};

/* =========================
   7) Random chunk box
   ========================= */
window.pickChunk = function(){
  const box = document.getElementById('chunkBox');
  if(!box) return;
  const pick = chunks6[Math.floor(Math.random()*chunks6.length)];
  box.innerHTML = `
    <div style="max-width:780px;width:100%">
      <div style="background:rgba(255,255,255,.86);border:1px solid rgba(30,42,68,.10);padding:14px;border-radius:18px;font-size:18px;line-height:1.7">
        <b>${pick.w}</b><br>
        ${pick.a}<br>
        + one more sentence
      </div>
    </div>
  `;
};

/* =========================
   8) Question spinner
   ========================= */
window.spinQ = function(targetId, list){
  const el = document.getElementById(targetId);
  if(!el) return;
  const pool = list || [...examPersonal6, ...examSchool6];
  const q = pool[Math.floor(Math.random()*pool.length)];
  el.innerHTML = `
    <div style="max-width:780px;width:100%">
      <div style="background:rgba(255,255,255,.86);border:1px solid rgba(30,42,68,.10);padding:16px;border-radius:18px;font-size:20px">
        ${q}
      </div>
      <div class="mini" style="margin-top:10px">Answer 2 sentences (2nd = detail)</div>
    </div>
  `;
};

/* =========================
   9) Picture spinner
   ========================= */
const picScenes = [
  {label:"SCHOOL", svg: sceneSVG("cover")},
  {label:"CLASSROOM", svg: sceneSVG("school")},
  {label:"LIBRARY", svg: sceneSVG("school")},
  {label:"CLUB", svg: `<svg viewBox="0 0 900 260" width="100%" height="240" role="img" aria-label="club">
    <rect width="900" height="260" rx="26" fill="rgba(255,255,255,.72)"/>
    <g transform="translate(220,70)">
      <rect x="0" y="0" width="460" height="150" rx="22" fill="rgba(251,113,133,.12)" stroke="rgba(251,113,133,.22)"/>
      <circle cx="160" cy="74" r="22" fill="#fff" opacity=".95"/>
      <circle cx="230" cy="62" r="22" fill="#fff" opacity=".95"/>
      <circle cx="300" cy="74" r="22" fill="#fff" opacity=".95"/>
      <rect x="140" y="104" width="220" height="34" rx="17" fill="#fff" opacity=".92"/>
      <text x="230" y="128" text-anchor="middle" font-size="18" fill="#1E2A44">club</text>
    </g>
  </svg>`},
  {label:"BREAK TIME", svg: `<svg viewBox="0 0 900 260" width="100%" height="240" role="img" aria-label="break time">
    <rect width="900" height="260" rx="26" fill="rgba(255,255,255,.72)"/>
    <g transform="translate(230,60)">
      <rect x="0" y="0" width="440" height="170" rx="24" fill="rgba(251,191,36,.14)" stroke="rgba(251,191,36,.26)"/>
      <g transform="translate(95,62)">
        <circle cx="0" cy="0" r="24" fill="#fff" stroke="rgba(30,42,68,.12)"/>
        <circle cx="-7" cy="-6" r="3" fill="#1E2A44"/><circle cx="7" cy="-6" r="3" fill="#1E2A44"/>
        <path d="M-10 8 Q0 16 10 8" fill="none" stroke="#1E2A44" stroke-width="4" stroke-linecap="round"/>
      </g>
      <g transform="translate(220,62)">
        <circle cx="0" cy="0" r="24" fill="#fff" stroke="rgba(30,42,68,.12)"/>
        <circle cx="-7" cy="-6" r="3" fill="#1E2A44"/><circle cx="7" cy="-6" r="3" fill="#1E2A44"/>
        <path d="M-10 8 Q0 16 10 8" fill="none" stroke="#1E2A44" stroke-width="4" stroke-linecap="round"/>
      </g>
      <g transform="translate(345,62)">
        <circle cx="0" cy="0" r="24" fill="#fff" stroke="rgba(30,42,68,.12)"/>
        <circle cx="-7" cy="-6" r="3" fill="#1E2A44"/><circle cx="7" cy="-6" r="3" fill="#1E2A44"/>
        <path d="M-10 8 Q0 16 10 8" fill="none" stroke="#1E2A44" stroke-width="4" stroke-linecap="round"/>
      </g>
      <text x="220" y="142" text-anchor="middle" font-size="18" fill="#1E2A44">break time</text>
    </g>
  </svg>`},
];

window.spinPic = function(){
  const label = document.getElementById('picLabel');
  const stage = document.getElementById('picStage');
  if(!label || !stage) return;
  const p = picScenes[Math.floor(Math.random()*picScenes.length)];
  label.innerHTML = `<b>Picture: ${p.label}</b>`;
  stage.innerHTML = p.svg;
};

/* =========================
   10) Build-a-sentence (simplified)
   ========================= */
const build = {tokens:[]};
const tileBank = [
  "My name is", "I‚Äôm", "years old", "I live in", "I live with", "I come from",
  "I study at", "My school is", "My favourite subject is", "After school, I often",
  "I get along with my classmates", "I do homework at home", "I feel",
  "English", "maths", "science", "PE",
  "friendly", "helpful", "interesting", "useful", "comfortable", "popular",
  "because", "and", "also", "then", "when",
  "it helps me speak better", "I like games", "I get good marks"
];

function mountBuildTiles(){
  const host = document.getElementById('tiles');
  if(!host) return;
  host.innerHTML = "";
  tileBank.forEach((t,i)=>{
    const b = document.createElement('button');
    b.className = (t==="because") ? "pink" : (i%3===0 ? "blue" : "");
    b.textContent = t;
    b.onclick = ()=>{ build.tokens.push(t); renderBuild(); };
    host.appendChild(b);
  });
}

function renderBuild(){
  const line = document.getElementById('buildLine');
  if(!line) return;
  line.innerHTML = "";
  build.tokens.forEach((t,i)=>{
    const w = document.createElement('button');
    w.textContent = t;
    w.className = "pink";
    w.style.padding = "10px 12px";
    w.onclick = ()=>{ build.tokens.splice(i,1); renderBuild(); };
    line.appendChild(w);
  });
}

window.buildUndo = function(){ build.tokens.pop(); renderBuild(); };
window.buildClear = function(){ build.tokens = []; renderBuild(); };
window.buildRandom = function(){
  const starters = ["My favourite subject is","I study at","After school, I often","My school is"];
  const reasons = ["it‚Äôs useful","it‚Äôs interesting","my teacher is helpful","it helps me speak better","I like games"];
  const s = starters[Math.floor(Math.random()*starters.length)];
  const w = ["English","maths","science","PE","Sunshine School"][Math.floor(Math.random()*5)];
  const r1 = reasons[Math.floor(Math.random()*reasons.length)];
  build.tokens = [s, w, "because", r1];
  if(Math.random()<0.5){
    const r2 = reasons[Math.floor(Math.random()*reasons.length)];
    build.tokens.push("and","because", r2);
  }
  renderBuild();
};

/* =========================
   11) Timer (single ring)
   ========================= */
let timer = {running:false, t:0, total:40, raf:null, last:0};

function setRing(progress01){
  const ring = document.getElementById('ring');
  if(!ring) return;
  ring.style.setProperty('--deg', (Math.max(0,Math.min(1,progress01))*360) + 'deg');
}

window.startTimer = function(seconds){
  timer.total = seconds;
  timer.t = seconds;
  timer.running = true;
  timer.last = performance.now();
  const n = document.getElementById('tNum');
  if(n) n.textContent = String(seconds);
  setRing(0);
  if(timer.raf) cancelAnimationFrame(timer.raf);
  timer.raf = requestAnimationFrame(tick);
};

window.pauseTimer = function(){ timer.running = false; };
window.resetTimer = function(){
  timer.running = false;
  const n = document.getElementById('tNum');
  if(n) n.textContent = String(timer.total);
  setRing(0);
};

function tick(now){
  timer.raf = requestAnimationFrame(tick);
  if(!timer.running) return;

  const dt = (now - timer.last)/1000;
  timer.last = now;

  timer.t -= dt;
  const show = Math.max(0, Math.ceil(timer.t));
  const n = document.getElementById('tNum');
  if(n) n.textContent = String(show);

  const elapsed = timer.total - timer.t;
  setRing(elapsed/timer.total);

  if(timer.t<=0){
    timer.running = false;
    setRing(1);
  }
}
</script>
</body>
</html>
